{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nimport { AgPromise, Autowired, AgGroupComponent, TabGuardComp, _, PostConstruct } from '@ag-grid-community/core';\nimport { MenuItemComponent } from '@ag-grid-enterprise/menu';\n\nvar MultiFilter = function (_super) {\n  __extends(MultiFilter, _super);\n\n  function MultiFilter() {\n    var _this = _super.call(this,\n    /* html */\n    \"<div class=\\\"ag-multi-filter ag-menu-list-compact\\\"></div>\") || this;\n\n    _this.filterDefs = [];\n    _this.filters = [];\n    _this.guiDestroyFuncs = [];\n    _this.activeFilterIndices = [];\n    _this.lastActivatedMenuItem = null;\n    _this.afterFiltersReadyFuncs = [];\n    return _this;\n  }\n\n  MultiFilter.prototype.postConstruct = function () {\n    var _this = this;\n\n    this.initialiseTabGuard({\n      onFocusIn: function (e) {\n        return _this.onFocusIn(e);\n      }\n    });\n  };\n\n  MultiFilter.getFilterDefs = function (params) {\n    var filters = params.filters;\n    return filters && filters.length > 0 ? filters : [{\n      filter: 'agTextColumnFilter'\n    }, {\n      filter: 'agSetColumnFilter'\n    }];\n  };\n\n  MultiFilter.prototype.init = function (params) {\n    var _this = this;\n\n    this.params = params;\n    this.filterDefs = MultiFilter.getFilterDefs(params);\n    var column = params.column,\n        filterChangedCallback = params.filterChangedCallback;\n    this.column = column;\n    this.filterChangedCallback = filterChangedCallback;\n    var filterPromises = [];\n\n    _.forEach(this.filterDefs, function (filterDef, index) {\n      var filterPromise = _this.createFilter(filterDef, index);\n\n      if (filterPromise != null) {\n        filterPromises.push(filterPromise);\n      }\n    }); // we have to refresh the GUI here to ensure that Angular components are not rendered in odd places\n\n\n    return AgPromise.all(filterPromises).then(function (filters) {\n      _this.filters = filters;\n\n      _this.refreshGui('columnMenu');\n\n      _this.afterFiltersReadyFuncs.forEach(function (f) {\n        return f();\n      });\n\n      _this.afterFiltersReadyFuncs.length = 0;\n    });\n  };\n\n  MultiFilter.prototype.refreshGui = function (container) {\n    var _this = this;\n\n    if (container === this.lastOpenedInContainer) {\n      return;\n    }\n\n    this.removeAllChildrenExceptTabGuards();\n    this.destroyChildren();\n\n    _.forEach(this.filters, function (filter, index) {\n      if (index > 0) {\n        _this.appendChild(_.loadTemplate(\n        /* html */\n        \"<div class=\\\"ag-filter-separator\\\"></div>\"));\n      }\n\n      var filterDef = _this.filterDefs[index];\n\n      var filterTitle = _this.getFilterTitle(filter, filterDef);\n\n      var filterGui;\n\n      if (filterDef.display === 'subMenu' && container !== 'toolPanel') {\n        // prevent sub-menu being used in tool panel\n        var menuItem = _this.insertFilterMenu(filter, filterTitle);\n\n        filterGui = menuItem.getGui();\n      } else if (filterDef.display === 'subMenu' || filterDef.display === 'accordion') {\n        // sub-menus should appear as groups in the tool panel\n        var group = _this.insertFilterGroup(filter, filterTitle);\n\n        filterGui = group.getGui();\n      } else {\n        // display inline\n        filterGui = filter.getGui();\n      }\n\n      _this.appendChild(filterGui);\n    });\n\n    this.lastOpenedInContainer = container;\n  };\n\n  MultiFilter.prototype.getFilterTitle = function (filter, filterDef) {\n    if (filterDef.title != null) {\n      return filterDef.title;\n    }\n\n    var filterWithoutType = filter;\n    return typeof filterWithoutType.getFilterTitle === 'function' ? filterWithoutType.getFilterTitle() : 'Filter';\n  };\n\n  MultiFilter.prototype.destroyChildren = function () {\n    _.forEach(this.guiDestroyFuncs, function (func) {\n      return func();\n    });\n\n    this.guiDestroyFuncs.length = 0;\n  };\n\n  MultiFilter.prototype.insertFilterMenu = function (filter, name) {\n    var _this = this;\n\n    var menuItem = this.createBean(new MenuItemComponent({\n      name: name,\n      subMenu: filter,\n      cssClasses: ['ag-multi-filter-menu-item'],\n      isCompact: true,\n      isAnotherSubMenuOpen: function () {\n        return false;\n      }\n    }));\n    menuItem.setParentComponent(this);\n    this.guiDestroyFuncs.push(function () {\n      return _this.destroyBean(menuItem);\n    });\n    this.addManagedListener(menuItem, MenuItemComponent.EVENT_MENU_ITEM_ACTIVATED, function (event) {\n      if (_this.lastActivatedMenuItem && _this.lastActivatedMenuItem !== event.menuItem) {\n        _this.lastActivatedMenuItem.deactivate();\n      }\n\n      _this.lastActivatedMenuItem = event.menuItem;\n    });\n    menuItem.addGuiEventListener('focusin', function () {\n      return menuItem.activate();\n    });\n    menuItem.addGuiEventListener('focusout', function () {\n      if (!menuItem.isSubMenuOpen()) {\n        menuItem.deactivate();\n      }\n    });\n    return menuItem;\n  };\n\n  MultiFilter.prototype.insertFilterGroup = function (filter, title) {\n    var _this = this;\n\n    var group = this.createBean(new AgGroupComponent({\n      title: title,\n      cssIdentifier: 'multi-filter'\n    }));\n    this.guiDestroyFuncs.push(function () {\n      return _this.destroyBean(group);\n    });\n    group.addItem(filter.getGui());\n    group.toggleGroupExpand(false);\n\n    if (filter.afterGuiAttached) {\n      var params_1 = {\n        container: this.lastOpenedInContainer,\n        suppressFocus: true\n      };\n      group.addManagedListener(group, AgGroupComponent.EVENT_EXPANDED, function () {\n        return filter.afterGuiAttached(params_1);\n      });\n    }\n\n    return group;\n  };\n\n  MultiFilter.prototype.isFilterActive = function () {\n    return _.some(this.filters, function (filter) {\n      return filter.isFilterActive();\n    });\n  };\n\n  MultiFilter.prototype.getLastActiveFilterIndex = function () {\n    return this.activeFilterIndices.length > 0 ? this.activeFilterIndices[this.activeFilterIndices.length - 1] : null;\n  };\n\n  MultiFilter.prototype.doesFilterPass = function (params, filterToSkip) {\n    var rowPasses = true;\n    this.filters.forEach(function (filter) {\n      if (!rowPasses || filter === filterToSkip || !filter.isFilterActive()) {\n        return;\n      }\n\n      rowPasses = filter.doesFilterPass(params);\n    });\n    return rowPasses;\n  };\n\n  MultiFilter.prototype.getFilterType = function () {\n    return 'multi';\n  };\n\n  MultiFilter.prototype.getModelFromUi = function () {\n    var model = {\n      filterType: this.getFilterType(),\n      filterModels: _.map(this.filters, function (filter) {\n        var providedFilter = filter;\n\n        if (typeof providedFilter.getModelFromUi === 'function') {\n          return providedFilter.getModelFromUi();\n        }\n\n        return null;\n      })\n    };\n    return model;\n  };\n\n  MultiFilter.prototype.getModel = function () {\n    if (!this.isFilterActive()) {\n      return null;\n    }\n\n    var model = {\n      filterType: this.getFilterType(),\n      filterModels: _.map(this.filters, function (filter) {\n        if (filter.isFilterActive()) {\n          return filter.getModel();\n        }\n\n        return null;\n      })\n    };\n    return model;\n  };\n\n  MultiFilter.prototype.setModel = function (model) {\n    var _this = this;\n\n    var setFilterModel = function (filter, filterModel) {\n      return new AgPromise(function (resolve) {\n        var promise = filter.setModel(filterModel);\n        promise ? promise.then(function () {\n          return resolve();\n        }) : resolve();\n      });\n    };\n\n    var promises = [];\n\n    if (model == null) {\n      promises = _.map(this.filters, function (filter, index) {\n        var res = setFilterModel(filter, null);\n\n        _this.updateActiveList(index);\n\n        return res;\n      });\n    } else {\n      _.forEach(this.filters, function (filter, index) {\n        var filterModel = model.filterModels.length > index ? model.filterModels[index] : null;\n        var res = setFilterModel(filter, filterModel);\n        promises.push(res);\n\n        _this.updateActiveList(index);\n      });\n    }\n\n    return AgPromise.all(promises).then(function () {});\n  };\n\n  MultiFilter.prototype.getChildFilterInstance = function (index) {\n    return this.filters[index];\n  };\n\n  MultiFilter.prototype.afterGuiAttached = function (params) {\n    if (params) {\n      this.refreshGui(params.container);\n    }\n\n    var filters = this.params.filters;\n\n    var suppressFocus = filters && _.some(filters, function (filter) {\n      return filter.display && filter.display !== 'inline';\n    });\n\n    this.executeFunctionIfExists('afterGuiAttached', __assign(__assign({}, params || {}), {\n      suppressFocus: suppressFocus\n    }));\n\n    if (suppressFocus) {\n      // reset focus to the top of the container, and blur\n      this.forceFocusOutOfContainer(true);\n    }\n  };\n\n  MultiFilter.prototype.onAnyFilterChanged = function () {\n    this.executeFunctionIfExists('onAnyFilterChanged');\n  };\n\n  MultiFilter.prototype.onNewRowsLoaded = function () {\n    this.executeFunctionIfExists('onNewRowsLoaded');\n  };\n\n  MultiFilter.prototype.destroy = function () {\n    var _this = this;\n\n    _.forEach(this.filters, function (filter) {\n      filter.setModel(null);\n\n      _this.destroyBean(filter);\n    });\n\n    this.filters.length = 0;\n    this.destroyChildren();\n\n    _super.prototype.destroy.call(this);\n  };\n\n  MultiFilter.prototype.executeFunctionIfExists = function (name) {\n    var params = [];\n\n    for (var _i = 1; _i < arguments.length; _i++) {\n      params[_i - 1] = arguments[_i];\n    } // The first filter is always the \"dominant\" one. By iterating in reverse order we ensure the first filter\n    // always gets the last say\n\n\n    _.forEachReverse(this.filters, function (filter) {\n      var func = filter[name];\n\n      if (typeof func === 'function') {\n        func.apply(filter, params);\n      }\n    });\n  };\n\n  MultiFilter.prototype.createFilter = function (filterDef, index) {\n    var _this = this;\n\n    var _a = this.params,\n        filterModifiedCallback = _a.filterModifiedCallback,\n        doesRowPassOtherFilter = _a.doesRowPassOtherFilter;\n    var filterInstance;\n\n    var filterParams = __assign(__assign({}, this.filterManager.createFilterParams(this.column, this.column.getColDef())), {\n      filterModifiedCallback: filterModifiedCallback,\n      filterChangedCallback: function (additionalEventAttributes) {\n        _this.executeWhenAllFiltersReady(function () {\n          return _this.filterChanged(index, additionalEventAttributes);\n        });\n      },\n      doesRowPassOtherFilter: function (node) {\n        return doesRowPassOtherFilter(node) && _this.doesFilterPass({\n          node: node,\n          data: node.data\n        }, filterInstance);\n      }\n    });\n\n    var filterPromise = this.userComponentFactory.newFilterComponent(filterDef, filterParams, 'agTextColumnFilter');\n\n    if (filterPromise != null) {\n      return filterPromise.then(function (filter) {\n        return filterInstance = filter;\n      });\n    }\n\n    return filterPromise;\n  };\n\n  MultiFilter.prototype.executeWhenAllFiltersReady = function (action) {\n    if (this.filters && this.filters.length > 0) {\n      action();\n    } else {\n      this.afterFiltersReadyFuncs.push(action);\n    }\n  };\n\n  MultiFilter.prototype.updateActiveList = function (index) {\n    var changedFilter = this.filters[index];\n\n    _.removeFromArray(this.activeFilterIndices, index);\n\n    if (changedFilter.isFilterActive()) {\n      this.activeFilterIndices.push(index);\n    }\n  };\n\n  MultiFilter.prototype.filterChanged = function (index, additionalEventAttributes) {\n    this.updateActiveList(index);\n    this.filterChangedCallback(additionalEventAttributes);\n    var changedFilter = this.filters[index];\n\n    _.forEach(this.filters, function (filter) {\n      if (filter === changedFilter) {\n        return;\n      }\n\n      if (typeof filter.onAnyFilterChanged === 'function') {\n        filter.onAnyFilterChanged();\n      }\n    });\n  };\n\n  MultiFilter.prototype.onFocusIn = function (e) {\n    if (this.lastActivatedMenuItem != null && !this.lastActivatedMenuItem.getGui().contains(e.target)) {\n      this.lastActivatedMenuItem.deactivate();\n      this.lastActivatedMenuItem = null;\n    }\n\n    return true;\n  };\n\n  __decorate([Autowired('filterManager')], MultiFilter.prototype, \"filterManager\", void 0);\n\n  __decorate([Autowired('userComponentFactory')], MultiFilter.prototype, \"userComponentFactory\", void 0);\n\n  __decorate([PostConstruct], MultiFilter.prototype, \"postConstruct\", null);\n\n  return MultiFilter;\n}(TabGuardComp);\n\nexport { MultiFilter };","map":{"version":3,"sources":["C:/dev/streamlit-aggrid/st_aggrid/frontend/node_modules/@ag-grid-enterprise/multi-filter/dist/es6/multiFilter/multiFilter.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__assign","assign","t","s","i","n","arguments","length","call","apply","__decorate","decorators","target","key","desc","c","r","getOwnPropertyDescriptor","Reflect","decorate","defineProperty","AgPromise","Autowired","AgGroupComponent","TabGuardComp","_","PostConstruct","MenuItemComponent","MultiFilter","_super","_this","filterDefs","filters","guiDestroyFuncs","activeFilterIndices","lastActivatedMenuItem","afterFiltersReadyFuncs","postConstruct","initialiseTabGuard","onFocusIn","e","getFilterDefs","params","filter","init","column","filterChangedCallback","filterPromises","forEach","filterDef","index","filterPromise","createFilter","push","all","then","refreshGui","f","container","lastOpenedInContainer","removeAllChildrenExceptTabGuards","destroyChildren","appendChild","loadTemplate","filterTitle","getFilterTitle","filterGui","display","menuItem","insertFilterMenu","getGui","group","insertFilterGroup","title","filterWithoutType","func","name","createBean","subMenu","cssClasses","isCompact","isAnotherSubMenuOpen","setParentComponent","destroyBean","addManagedListener","EVENT_MENU_ITEM_ACTIVATED","event","deactivate","addGuiEventListener","activate","isSubMenuOpen","cssIdentifier","addItem","toggleGroupExpand","afterGuiAttached","params_1","suppressFocus","EVENT_EXPANDED","isFilterActive","some","getLastActiveFilterIndex","doesFilterPass","filterToSkip","rowPasses","getFilterType","getModelFromUi","model","filterType","filterModels","map","providedFilter","getModel","setModel","setFilterModel","filterModel","resolve","promise","promises","res","updateActiveList","getChildFilterInstance","executeFunctionIfExists","forceFocusOutOfContainer","onAnyFilterChanged","onNewRowsLoaded","destroy","_i","forEachReverse","_a","filterModifiedCallback","doesRowPassOtherFilter","filterInstance","filterParams","filterManager","createFilterParams","getColDef","additionalEventAttributes","executeWhenAllFiltersReady","filterChanged","node","data","userComponentFactory","newFilterComponent","action","changedFilter","removeFromArray","contains"],"mappings":"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","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nimport { AgPromise, Autowired, AgGroupComponent, TabGuardComp, _, PostConstruct } from '@ag-grid-community/core';\nimport { MenuItemComponent } from '@ag-grid-enterprise/menu';\nvar MultiFilter = /** @class */ (function (_super) {\n    __extends(MultiFilter, _super);\n    function MultiFilter() {\n        var _this = _super.call(this, /* html */ \"<div class=\\\"ag-multi-filter ag-menu-list-compact\\\"></div>\") || this;\n        _this.filterDefs = [];\n        _this.filters = [];\n        _this.guiDestroyFuncs = [];\n        _this.activeFilterIndices = [];\n        _this.lastActivatedMenuItem = null;\n        _this.afterFiltersReadyFuncs = [];\n        return _this;\n    }\n    MultiFilter.prototype.postConstruct = function () {\n        var _this = this;\n        this.initialiseTabGuard({\n            onFocusIn: function (e) { return _this.onFocusIn(e); }\n        });\n    };\n    MultiFilter.getFilterDefs = function (params) {\n        var filters = params.filters;\n        return filters && filters.length > 0 ?\n            filters :\n            [{ filter: 'agTextColumnFilter' }, { filter: 'agSetColumnFilter' }];\n    };\n    MultiFilter.prototype.init = function (params) {\n        var _this = this;\n        this.params = params;\n        this.filterDefs = MultiFilter.getFilterDefs(params);\n        var column = params.column, filterChangedCallback = params.filterChangedCallback;\n        this.column = column;\n        this.filterChangedCallback = filterChangedCallback;\n        var filterPromises = [];\n        _.forEach(this.filterDefs, function (filterDef, index) {\n            var filterPromise = _this.createFilter(filterDef, index);\n            if (filterPromise != null) {\n                filterPromises.push(filterPromise);\n            }\n        });\n        // we have to refresh the GUI here to ensure that Angular components are not rendered in odd places\n        return AgPromise\n            .all(filterPromises)\n            .then(function (filters) {\n            _this.filters = filters;\n            _this.refreshGui('columnMenu');\n            _this.afterFiltersReadyFuncs.forEach(function (f) { return f(); });\n            _this.afterFiltersReadyFuncs.length = 0;\n        });\n    };\n    MultiFilter.prototype.refreshGui = function (container) {\n        var _this = this;\n        if (container === this.lastOpenedInContainer) {\n            return;\n        }\n        this.removeAllChildrenExceptTabGuards();\n        this.destroyChildren();\n        _.forEach(this.filters, function (filter, index) {\n            if (index > 0) {\n                _this.appendChild(_.loadTemplate(/* html */ \"<div class=\\\"ag-filter-separator\\\"></div>\"));\n            }\n            var filterDef = _this.filterDefs[index];\n            var filterTitle = _this.getFilterTitle(filter, filterDef);\n            var filterGui;\n            if (filterDef.display === 'subMenu' && container !== 'toolPanel') {\n                // prevent sub-menu being used in tool panel\n                var menuItem = _this.insertFilterMenu(filter, filterTitle);\n                filterGui = menuItem.getGui();\n            }\n            else if (filterDef.display === 'subMenu' || filterDef.display === 'accordion') {\n                // sub-menus should appear as groups in the tool panel\n                var group = _this.insertFilterGroup(filter, filterTitle);\n                filterGui = group.getGui();\n            }\n            else {\n                // display inline\n                filterGui = filter.getGui();\n            }\n            _this.appendChild(filterGui);\n        });\n        this.lastOpenedInContainer = container;\n    };\n    MultiFilter.prototype.getFilterTitle = function (filter, filterDef) {\n        if (filterDef.title != null) {\n            return filterDef.title;\n        }\n        var filterWithoutType = filter;\n        return typeof filterWithoutType.getFilterTitle === 'function' ? filterWithoutType.getFilterTitle() : 'Filter';\n    };\n    MultiFilter.prototype.destroyChildren = function () {\n        _.forEach(this.guiDestroyFuncs, function (func) { return func(); });\n        this.guiDestroyFuncs.length = 0;\n    };\n    MultiFilter.prototype.insertFilterMenu = function (filter, name) {\n        var _this = this;\n        var menuItem = this.createBean(new MenuItemComponent({\n            name: name,\n            subMenu: filter,\n            cssClasses: ['ag-multi-filter-menu-item'],\n            isCompact: true,\n            isAnotherSubMenuOpen: function () { return false; },\n        }));\n        menuItem.setParentComponent(this);\n        this.guiDestroyFuncs.push(function () { return _this.destroyBean(menuItem); });\n        this.addManagedListener(menuItem, MenuItemComponent.EVENT_MENU_ITEM_ACTIVATED, function (event) {\n            if (_this.lastActivatedMenuItem && _this.lastActivatedMenuItem !== event.menuItem) {\n                _this.lastActivatedMenuItem.deactivate();\n            }\n            _this.lastActivatedMenuItem = event.menuItem;\n        });\n        menuItem.addGuiEventListener('focusin', function () { return menuItem.activate(); });\n        menuItem.addGuiEventListener('focusout', function () {\n            if (!menuItem.isSubMenuOpen()) {\n                menuItem.deactivate();\n            }\n        });\n        return menuItem;\n    };\n    MultiFilter.prototype.insertFilterGroup = function (filter, title) {\n        var _this = this;\n        var group = this.createBean(new AgGroupComponent({\n            title: title,\n            cssIdentifier: 'multi-filter',\n        }));\n        this.guiDestroyFuncs.push(function () { return _this.destroyBean(group); });\n        group.addItem(filter.getGui());\n        group.toggleGroupExpand(false);\n        if (filter.afterGuiAttached) {\n            var params_1 = { container: this.lastOpenedInContainer, suppressFocus: true };\n            group.addManagedListener(group, AgGroupComponent.EVENT_EXPANDED, function () { return filter.afterGuiAttached(params_1); });\n        }\n        return group;\n    };\n    MultiFilter.prototype.isFilterActive = function () {\n        return _.some(this.filters, function (filter) { return filter.isFilterActive(); });\n    };\n    MultiFilter.prototype.getLastActiveFilterIndex = function () {\n        return this.activeFilterIndices.length > 0 ? this.activeFilterIndices[this.activeFilterIndices.length - 1] : null;\n    };\n    MultiFilter.prototype.doesFilterPass = function (params, filterToSkip) {\n        var rowPasses = true;\n        this.filters.forEach(function (filter) {\n            if (!rowPasses || filter === filterToSkip || !filter.isFilterActive()) {\n                return;\n            }\n            rowPasses = filter.doesFilterPass(params);\n        });\n        return rowPasses;\n    };\n    MultiFilter.prototype.getFilterType = function () {\n        return 'multi';\n    };\n    MultiFilter.prototype.getModelFromUi = function () {\n        var model = {\n            filterType: this.getFilterType(),\n            filterModels: _.map(this.filters, function (filter) {\n                var providedFilter = filter;\n                if (typeof providedFilter.getModelFromUi === 'function') {\n                    return providedFilter.getModelFromUi();\n                }\n                return null;\n            })\n        };\n        return model;\n    };\n    MultiFilter.prototype.getModel = function () {\n        if (!this.isFilterActive()) {\n            return null;\n        }\n        var model = {\n            filterType: this.getFilterType(),\n            filterModels: _.map(this.filters, function (filter) {\n                if (filter.isFilterActive()) {\n                    return filter.getModel();\n                }\n                return null;\n            })\n        };\n        return model;\n    };\n    MultiFilter.prototype.setModel = function (model) {\n        var _this = this;\n        var setFilterModel = function (filter, filterModel) {\n            return new AgPromise(function (resolve) {\n                var promise = filter.setModel(filterModel);\n                promise ? promise.then(function () { return resolve(); }) : resolve();\n            });\n        };\n        var promises = [];\n        if (model == null) {\n            promises = _.map(this.filters, function (filter, index) {\n                var res = setFilterModel(filter, null);\n                _this.updateActiveList(index);\n                return res;\n            });\n        }\n        else {\n            _.forEach(this.filters, function (filter, index) {\n                var filterModel = model.filterModels.length > index ? model.filterModels[index] : null;\n                var res = setFilterModel(filter, filterModel);\n                promises.push(res);\n                _this.updateActiveList(index);\n            });\n        }\n        return AgPromise.all(promises).then(function () { });\n    };\n    MultiFilter.prototype.getChildFilterInstance = function (index) {\n        return this.filters[index];\n    };\n    MultiFilter.prototype.afterGuiAttached = function (params) {\n        if (params) {\n            this.refreshGui(params.container);\n        }\n        var filters = this.params.filters;\n        var suppressFocus = filters && _.some(filters, function (filter) { return filter.display && filter.display !== 'inline'; });\n        this.executeFunctionIfExists('afterGuiAttached', __assign(__assign({}, params || {}), { suppressFocus: suppressFocus }));\n        if (suppressFocus) {\n            // reset focus to the top of the container, and blur\n            this.forceFocusOutOfContainer(true);\n        }\n    };\n    MultiFilter.prototype.onAnyFilterChanged = function () {\n        this.executeFunctionIfExists('onAnyFilterChanged');\n    };\n    MultiFilter.prototype.onNewRowsLoaded = function () {\n        this.executeFunctionIfExists('onNewRowsLoaded');\n    };\n    MultiFilter.prototype.destroy = function () {\n        var _this = this;\n        _.forEach(this.filters, function (filter) {\n            filter.setModel(null);\n            _this.destroyBean(filter);\n        });\n        this.filters.length = 0;\n        this.destroyChildren();\n        _super.prototype.destroy.call(this);\n    };\n    MultiFilter.prototype.executeFunctionIfExists = function (name) {\n        var params = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            params[_i - 1] = arguments[_i];\n        }\n        // The first filter is always the \"dominant\" one. By iterating in reverse order we ensure the first filter\n        // always gets the last say\n        _.forEachReverse(this.filters, function (filter) {\n            var func = filter[name];\n            if (typeof func === 'function') {\n                func.apply(filter, params);\n            }\n        });\n    };\n    MultiFilter.prototype.createFilter = function (filterDef, index) {\n        var _this = this;\n        var _a = this.params, filterModifiedCallback = _a.filterModifiedCallback, doesRowPassOtherFilter = _a.doesRowPassOtherFilter;\n        var filterInstance;\n        var filterParams = __assign(__assign({}, this.filterManager.createFilterParams(this.column, this.column.getColDef())), { filterModifiedCallback: filterModifiedCallback, filterChangedCallback: function (additionalEventAttributes) {\n                _this.executeWhenAllFiltersReady(function () { return _this.filterChanged(index, additionalEventAttributes); });\n            }, doesRowPassOtherFilter: function (node) {\n                return doesRowPassOtherFilter(node) && _this.doesFilterPass({ node: node, data: node.data }, filterInstance);\n            } });\n        var filterPromise = this.userComponentFactory.newFilterComponent(filterDef, filterParams, 'agTextColumnFilter');\n        if (filterPromise != null) {\n            return filterPromise.then(function (filter) { return filterInstance = filter; });\n        }\n        return filterPromise;\n    };\n    MultiFilter.prototype.executeWhenAllFiltersReady = function (action) {\n        if (this.filters && this.filters.length > 0) {\n            action();\n        }\n        else {\n            this.afterFiltersReadyFuncs.push(action);\n        }\n    };\n    MultiFilter.prototype.updateActiveList = function (index) {\n        var changedFilter = this.filters[index];\n        _.removeFromArray(this.activeFilterIndices, index);\n        if (changedFilter.isFilterActive()) {\n            this.activeFilterIndices.push(index);\n        }\n    };\n    MultiFilter.prototype.filterChanged = function (index, additionalEventAttributes) {\n        this.updateActiveList(index);\n        this.filterChangedCallback(additionalEventAttributes);\n        var changedFilter = this.filters[index];\n        _.forEach(this.filters, function (filter) {\n            if (filter === changedFilter) {\n                return;\n            }\n            if (typeof filter.onAnyFilterChanged === 'function') {\n                filter.onAnyFilterChanged();\n            }\n        });\n    };\n    MultiFilter.prototype.onFocusIn = function (e) {\n        if (this.lastActivatedMenuItem != null && !this.lastActivatedMenuItem.getGui().contains(e.target)) {\n            this.lastActivatedMenuItem.deactivate();\n            this.lastActivatedMenuItem = null;\n        }\n        return true;\n    };\n    __decorate([\n        Autowired('filterManager')\n    ], MultiFilter.prototype, \"filterManager\", void 0);\n    __decorate([\n        Autowired('userComponentFactory')\n    ], MultiFilter.prototype, \"userComponentFactory\", void 0);\n    __decorate([\n        PostConstruct\n    ], MultiFilter.prototype, \"postConstruct\", null);\n    return MultiFilter;\n}(TabGuardComp));\nexport { MultiFilter };\n"]},"metadata":{},"sourceType":"module"}