{"ast":null,"code":"import { _ } from '@ag-grid-community/core';\nimport columnFactory from './column';\nimport rowFactory from './row';\nimport mergeCellFactory from './mergeCell';\nimport { ExcelXlsxFactory } from '../../excelXlsxFactory';\nimport { getExcelColumnName } from '../../assets/excelUtils';\n\nvar updateColMinMax = function (col, min, range, prevCol) {\n  if (!col.min) {\n    col.min = min;\n    col.max = min + range;\n    return;\n  }\n\n  var currentMin = min;\n\n  if (prevCol) {\n    currentMin = Math.max(currentMin, prevCol.min);\n  }\n\n  col.min = Math.max(col.min, currentMin);\n  col.max = Math.max(col.max, currentMin + range);\n};\n\nvar getMergedCells = function (rows, cols) {\n  var mergedCells = [];\n  rows.forEach(function (currentRow, rowIdx) {\n    var cells = currentRow.cells;\n    var merges = 0;\n    currentRow.index = rowIdx + 1;\n    var lastCol;\n    cells.forEach(function (currentCell, cellIdx) {\n      var min = cellIdx + merges + 1;\n      var start = getExcelColumnName(min);\n      var outputRow = rowIdx + 1;\n\n      if (currentCell.mergeAcross) {\n        merges += currentCell.mergeAcross;\n        var end = getExcelColumnName(cellIdx + merges + 1);\n        mergedCells.push(\"\" + start + outputRow + \":\" + end + outputRow);\n      }\n\n      if (!cols[min - 1]) {\n        cols[min - 1] = {};\n      }\n\n      updateColMinMax(cols[min - 1], min, merges, lastCol);\n      lastCol = cols[min - 1];\n      currentCell.ref = \"\" + start + outputRow;\n    });\n  });\n  return mergedCells;\n};\n\nvar getPageOrientation = function (orientation) {\n  if (!orientation || orientation !== 'Portrait' && orientation !== 'Landscape') {\n    return 'portrait';\n  }\n\n  return orientation.toLocaleLowerCase();\n};\n\nvar getPageSize = function (pageSize) {\n  if (pageSize == null) {\n    return 1;\n  }\n\n  var positions = ['Letter', 'Letter Small', 'Tabloid', 'Ledger', 'Legal', 'Statement', 'Executive', 'A3', 'A4', 'A4 Small', 'A5', 'A6', 'B4', 'B5', 'Folio', 'Envelope', 'Envelope DL', 'Envelope C5', 'Envelope B5', 'Envelope C3', 'Envelope C4', 'Envelope C6', 'Envelope Monarch', 'Japanese Postcard', 'Japanese Double Postcard'];\n  var pos = positions.indexOf(pageSize);\n  return pos === -1 ? 1 : pos + 1;\n};\n\nvar addColumns = function (columns) {\n  return function (children) {\n    if (columns.length) {\n      children.push({\n        name: 'cols',\n        children: columns.map(function (column) {\n          return columnFactory.getTemplate(column);\n        })\n      });\n    }\n\n    return children;\n  };\n};\n\nvar addSheetData = function (rows, sheetNumber) {\n  return function (children) {\n    if (rows.length) {\n      children.push({\n        name: 'sheetData',\n        children: rows.map(function (row, idx) {\n          return rowFactory.getTemplate(row, idx, sheetNumber);\n        })\n      });\n    }\n\n    return children;\n  };\n};\n\nvar addMergeCells = function (mergeCells) {\n  return function (children) {\n    if (mergeCells.length) {\n      children.push({\n        name: 'mergeCells',\n        properties: {\n          rawMap: {\n            count: mergeCells.length\n          }\n        },\n        children: mergeCells.map(function (mergedCell) {\n          return mergeCellFactory.getTemplate(mergedCell);\n        })\n      });\n    }\n\n    return children;\n  };\n};\n\nvar addPageMargins = function (margins) {\n  return function (children) {\n    var _a = margins.top,\n        top = _a === void 0 ? 0.75 : _a,\n        _b = margins.right,\n        right = _b === void 0 ? 0.7 : _b,\n        _c = margins.bottom,\n        bottom = _c === void 0 ? 0.75 : _c,\n        _d = margins.left,\n        left = _d === void 0 ? 0.7 : _d,\n        _e = margins.header,\n        header = _e === void 0 ? 0.3 : _e,\n        _f = margins.footer,\n        footer = _f === void 0 ? 0.3 : _f;\n    children.push({\n      name: 'pageMargins',\n      properties: {\n        rawMap: {\n          bottom: bottom,\n          footer: footer,\n          header: header,\n          left: left,\n          right: right,\n          top: top\n        }\n      }\n    });\n    return children;\n  };\n};\n\nvar addPageSetup = function (pageSetup) {\n  return function (children) {\n    if (pageSetup) {\n      children.push({\n        name: 'pageSetup',\n        properties: {\n          rawMap: {\n            horizontalDpi: 0,\n            verticalDpi: 0,\n            orientation: getPageOrientation(pageSetup.orientation),\n            paperSize: getPageSize(pageSetup.pageSize)\n          }\n        }\n      });\n    }\n\n    return children;\n  };\n};\n\nvar replaceHeaderFooterTokens = function (value) {\n  var map = {\n    '&[Page]': '&P',\n    '&[Pages]': '&N',\n    '&[Date]': '&D',\n    '&[Time]': '&T',\n    '&[Tab]': '&A',\n    '&[Path]': '&Z',\n    '&[File]': '&F'\n  };\n\n  _.iterateObject(map, function (key, val) {\n    value = value.replace(key, val);\n  });\n\n  return value;\n};\n\nvar getHeaderPosition = function (position) {\n  if (position === 'Center') {\n    return 'C';\n  } else if (position === 'Right') {\n    return 'R';\n  }\n\n  return 'L';\n};\n\nvar applyHeaderFontStyle = function (headerString, font) {\n  if (!font) {\n    return headerString;\n  }\n\n  headerString += '&amp;&quot;';\n  headerString += font.fontName || 'Calibri';\n\n  if (font.bold !== font.italic) {\n    headerString += font.bold ? ',Bold' : ',Italic';\n  } else if (font.bold) {\n    headerString += ',Bold Italic';\n  } else {\n    headerString += ',Regular';\n  }\n\n  headerString += '&quot;';\n\n  if (font.size) {\n    headerString += \"&amp;\" + font.size;\n  }\n\n  if (font.strikeThrough) {\n    headerString += '&amp;S';\n  }\n\n  if (font.underline) {\n    headerString += \"&amp;\" + (font.underline === 'Double' ? 'E' : 'U');\n  }\n\n  if (font.color) {\n    headerString += \"&amp;K\" + font.color.replace('#', '').toUpperCase();\n  }\n\n  return headerString;\n};\n\nvar processHeaderFooterContent = function (content) {\n  return content.reduce(function (prev, curr) {\n    var pos = getHeaderPosition(curr.position);\n    var output = applyHeaderFontStyle(prev + \"&amp;\" + pos, curr.font);\n    return \"\" + output + _.escapeString(replaceHeaderFooterTokens(curr.value));\n  }, '');\n};\n\nvar buildHeaderFooter = function (headerFooterConfig) {\n  var rules = ['all', 'first', 'even'];\n  var headersAndFooters = [];\n  rules.forEach(function (rule) {\n    var headerFooter = headerFooterConfig[rule];\n    var namePrefix = rule === 'all' ? 'odd' : rule;\n\n    if (!headerFooter || !headerFooter.header && !headerFooter.footer) {\n      return;\n    }\n\n    _.iterateObject(headerFooter, function (key, value) {\n      var nameSuffix = \"\" + key.charAt(0).toUpperCase() + key.slice(1);\n\n      if (value) {\n        headersAndFooters.push({\n          name: \"\" + namePrefix + nameSuffix,\n          properties: {\n            rawMap: {\n              'xml:space': 'preserve'\n            }\n          },\n          textNode: processHeaderFooterContent(value)\n        });\n      }\n    });\n  });\n  return headersAndFooters;\n};\n\nvar addHeaderFooter = function (headerFooterConfig) {\n  return function (children) {\n    if (!headerFooterConfig) {\n      return children;\n    }\n\n    var differentFirst = headerFooterConfig.first != null ? 1 : 0;\n    var differentOddEven = headerFooterConfig.even != null ? 1 : 0;\n    children.push({\n      name: 'headerFooter',\n      properties: {\n        rawMap: {\n          differentFirst: differentFirst,\n          differentOddEven: differentOddEven\n        }\n      },\n      children: buildHeaderFooter(headerFooterConfig)\n    });\n    return children;\n  };\n};\n\nvar addDrawingRel = function (currentSheet) {\n  return function (children) {\n    if (ExcelXlsxFactory.worksheetImages.get(currentSheet)) {\n      children.push({\n        name: 'drawing',\n        properties: {\n          rawMap: {\n            'r:id': 'rId1'\n          }\n        }\n      });\n    }\n\n    return children;\n  };\n};\n\nvar worksheetFactory = {\n  getTemplate: function (params) {\n    var worksheet = params.worksheet,\n        currentSheet = params.currentSheet,\n        _a = params.margins,\n        margins = _a === void 0 ? {} : _a,\n        pageSetup = params.pageSetup,\n        headerFooterConfig = params.headerFooterConfig;\n    var table = worksheet.table;\n    var rows = table.rows,\n        columns = table.columns;\n    var mergedCells = columns && columns.length ? getMergedCells(rows, columns) : [];\n\n    var createWorksheetChildren = _.compose(addColumns(columns), addSheetData(rows, currentSheet + 1), addMergeCells(mergedCells), addPageMargins(margins), addPageSetup(pageSetup), addHeaderFooter(headerFooterConfig), addDrawingRel(currentSheet));\n\n    var children = createWorksheetChildren([]);\n    return {\n      name: \"worksheet\",\n      properties: {\n        prefixedAttributes: [{\n          prefix: \"xmlns:\",\n          map: {\n            r: \"http://schemas.openxmlformats.org/officeDocument/2006/relationships\"\n          }\n        }],\n        rawMap: {\n          xmlns: \"http://schemas.openxmlformats.org/spreadsheetml/2006/main\"\n        }\n      },\n      children: children\n    };\n  }\n};\nexport default worksheetFactory;","map":{"version":3,"sources":["C:/dev/streamlit-aggrid/st_aggrid/frontend/node_modules/@ag-grid-enterprise/excel-export/dist/es6/excelExport/files/ooxml/worksheet.js"],"names":["_","columnFactory","rowFactory","mergeCellFactory","ExcelXlsxFactory","getExcelColumnName","updateColMinMax","col","min","range","prevCol","max","currentMin","Math","getMergedCells","rows","cols","mergedCells","forEach","currentRow","rowIdx","cells","merges","index","lastCol","currentCell","cellIdx","start","outputRow","mergeAcross","end","push","ref","getPageOrientation","orientation","toLocaleLowerCase","getPageSize","pageSize","positions","pos","indexOf","addColumns","columns","children","length","name","map","column","getTemplate","addSheetData","sheetNumber","row","idx","addMergeCells","mergeCells","properties","rawMap","count","mergedCell","addPageMargins","margins","_a","top","_b","right","_c","bottom","_d","left","_e","header","_f","footer","addPageSetup","pageSetup","horizontalDpi","verticalDpi","paperSize","replaceHeaderFooterTokens","value","iterateObject","key","val","replace","getHeaderPosition","position","applyHeaderFontStyle","headerString","font","fontName","bold","italic","size","strikeThrough","underline","color","toUpperCase","processHeaderFooterContent","content","reduce","prev","curr","output","escapeString","buildHeaderFooter","headerFooterConfig","rules","headersAndFooters","rule","headerFooter","namePrefix","nameSuffix","charAt","slice","textNode","addHeaderFooter","differentFirst","first","differentOddEven","even","addDrawingRel","currentSheet","worksheetImages","get","worksheetFactory","params","worksheet","table","createWorksheetChildren","compose","prefixedAttributes","prefix","r","xmlns"],"mappings":"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","sourcesContent":["import { _ } from '@ag-grid-community/core';\nimport columnFactory from './column';\nimport rowFactory from './row';\nimport mergeCellFactory from './mergeCell';\nimport { ExcelXlsxFactory } from '../../excelXlsxFactory';\nimport { getExcelColumnName } from '../../assets/excelUtils';\nvar updateColMinMax = function (col, min, range, prevCol) {\n    if (!col.min) {\n        col.min = min;\n        col.max = min + range;\n        return;\n    }\n    var currentMin = min;\n    if (prevCol) {\n        currentMin = Math.max(currentMin, prevCol.min);\n    }\n    col.min = Math.max(col.min, currentMin);\n    col.max = Math.max(col.max, currentMin + range);\n};\nvar getMergedCells = function (rows, cols) {\n    var mergedCells = [];\n    rows.forEach(function (currentRow, rowIdx) {\n        var cells = currentRow.cells;\n        var merges = 0;\n        currentRow.index = rowIdx + 1;\n        var lastCol;\n        cells.forEach(function (currentCell, cellIdx) {\n            var min = cellIdx + merges + 1;\n            var start = getExcelColumnName(min);\n            var outputRow = rowIdx + 1;\n            if (currentCell.mergeAcross) {\n                merges += currentCell.mergeAcross;\n                var end = getExcelColumnName(cellIdx + merges + 1);\n                mergedCells.push(\"\" + start + outputRow + \":\" + end + outputRow);\n            }\n            if (!cols[min - 1]) {\n                cols[min - 1] = {};\n            }\n            updateColMinMax(cols[min - 1], min, merges, lastCol);\n            lastCol = cols[min - 1];\n            currentCell.ref = \"\" + start + outputRow;\n        });\n    });\n    return mergedCells;\n};\nvar getPageOrientation = function (orientation) {\n    if (!orientation || (orientation !== 'Portrait' && orientation !== 'Landscape')) {\n        return 'portrait';\n    }\n    return orientation.toLocaleLowerCase();\n};\nvar getPageSize = function (pageSize) {\n    if (pageSize == null) {\n        return 1;\n    }\n    var positions = ['Letter', 'Letter Small', 'Tabloid', 'Ledger', 'Legal', 'Statement', 'Executive', 'A3', 'A4', 'A4 Small', 'A5', 'A6', 'B4', 'B5', 'Folio', 'Envelope', 'Envelope DL', 'Envelope C5', 'Envelope B5', 'Envelope C3', 'Envelope C4', 'Envelope C6', 'Envelope Monarch', 'Japanese Postcard', 'Japanese Double Postcard'];\n    var pos = positions.indexOf(pageSize);\n    return pos === -1 ? 1 : (pos + 1);\n};\nvar addColumns = function (columns) {\n    return function (children) {\n        if (columns.length) {\n            children.push({\n                name: 'cols',\n                children: columns.map(function (column) { return columnFactory.getTemplate(column); })\n            });\n        }\n        return children;\n    };\n};\nvar addSheetData = function (rows, sheetNumber) {\n    return function (children) {\n        if (rows.length) {\n            children.push({\n                name: 'sheetData',\n                children: rows.map(function (row, idx) { return rowFactory.getTemplate(row, idx, sheetNumber); })\n            });\n        }\n        return children;\n    };\n};\nvar addMergeCells = function (mergeCells) {\n    return function (children) {\n        if (mergeCells.length) {\n            children.push({\n                name: 'mergeCells',\n                properties: {\n                    rawMap: {\n                        count: mergeCells.length\n                    }\n                },\n                children: mergeCells.map(function (mergedCell) { return mergeCellFactory.getTemplate(mergedCell); })\n            });\n        }\n        return children;\n    };\n};\nvar addPageMargins = function (margins) {\n    return function (children) {\n        var _a = margins.top, top = _a === void 0 ? 0.75 : _a, _b = margins.right, right = _b === void 0 ? 0.7 : _b, _c = margins.bottom, bottom = _c === void 0 ? 0.75 : _c, _d = margins.left, left = _d === void 0 ? 0.7 : _d, _e = margins.header, header = _e === void 0 ? 0.3 : _e, _f = margins.footer, footer = _f === void 0 ? 0.3 : _f;\n        children.push({\n            name: 'pageMargins',\n            properties: {\n                rawMap: { bottom: bottom, footer: footer, header: header, left: left, right: right, top: top }\n            }\n        });\n        return children;\n    };\n};\nvar addPageSetup = function (pageSetup) {\n    return function (children) {\n        if (pageSetup) {\n            children.push({\n                name: 'pageSetup',\n                properties: {\n                    rawMap: {\n                        horizontalDpi: 0,\n                        verticalDpi: 0,\n                        orientation: getPageOrientation(pageSetup.orientation),\n                        paperSize: getPageSize(pageSetup.pageSize)\n                    }\n                }\n            });\n        }\n        return children;\n    };\n};\nvar replaceHeaderFooterTokens = function (value) {\n    var map = {\n        '&[Page]': '&P',\n        '&[Pages]': '&N',\n        '&[Date]': '&D',\n        '&[Time]': '&T',\n        '&[Tab]': '&A',\n        '&[Path]': '&Z',\n        '&[File]': '&F'\n    };\n    _.iterateObject(map, function (key, val) {\n        value = value.replace(key, val);\n    });\n    return value;\n};\nvar getHeaderPosition = function (position) {\n    if (position === 'Center') {\n        return 'C';\n    }\n    else if (position === 'Right') {\n        return 'R';\n    }\n    return 'L';\n};\nvar applyHeaderFontStyle = function (headerString, font) {\n    if (!font) {\n        return headerString;\n    }\n    headerString += '&amp;&quot;';\n    headerString += font.fontName || 'Calibri';\n    if (font.bold !== font.italic) {\n        headerString += font.bold ? ',Bold' : ',Italic';\n    }\n    else if (font.bold) {\n        headerString += ',Bold Italic';\n    }\n    else {\n        headerString += ',Regular';\n    }\n    headerString += '&quot;';\n    if (font.size) {\n        headerString += \"&amp;\" + font.size;\n    }\n    if (font.strikeThrough) {\n        headerString += '&amp;S';\n    }\n    if (font.underline) {\n        headerString += \"&amp;\" + (font.underline === 'Double' ? 'E' : 'U');\n    }\n    if (font.color) {\n        headerString += \"&amp;K\" + font.color.replace('#', '').toUpperCase();\n    }\n    return headerString;\n};\nvar processHeaderFooterContent = function (content) {\n    return content.reduce(function (prev, curr) {\n        var pos = getHeaderPosition(curr.position);\n        var output = applyHeaderFontStyle(prev + \"&amp;\" + pos, curr.font);\n        return \"\" + output + _.escapeString(replaceHeaderFooterTokens(curr.value));\n    }, '');\n};\nvar buildHeaderFooter = function (headerFooterConfig) {\n    var rules = ['all', 'first', 'even'];\n    var headersAndFooters = [];\n    rules.forEach(function (rule) {\n        var headerFooter = headerFooterConfig[rule];\n        var namePrefix = rule === 'all' ? 'odd' : rule;\n        if (!headerFooter || (!headerFooter.header && !headerFooter.footer)) {\n            return;\n        }\n        _.iterateObject(headerFooter, function (key, value) {\n            var nameSuffix = \"\" + key.charAt(0).toUpperCase() + key.slice(1);\n            if (value) {\n                headersAndFooters.push({\n                    name: \"\" + namePrefix + nameSuffix,\n                    properties: {\n                        rawMap: {\n                            'xml:space': 'preserve'\n                        }\n                    },\n                    textNode: processHeaderFooterContent(value)\n                });\n            }\n        });\n    });\n    return headersAndFooters;\n};\nvar addHeaderFooter = function (headerFooterConfig) {\n    return function (children) {\n        if (!headerFooterConfig) {\n            return children;\n        }\n        var differentFirst = headerFooterConfig.first != null ? 1 : 0;\n        var differentOddEven = headerFooterConfig.even != null ? 1 : 0;\n        children.push({\n            name: 'headerFooter',\n            properties: {\n                rawMap: {\n                    differentFirst: differentFirst,\n                    differentOddEven: differentOddEven\n                }\n            },\n            children: buildHeaderFooter(headerFooterConfig)\n        });\n        return children;\n    };\n};\nvar addDrawingRel = function (currentSheet) {\n    return function (children) {\n        if (ExcelXlsxFactory.worksheetImages.get(currentSheet)) {\n            children.push({\n                name: 'drawing',\n                properties: {\n                    rawMap: {\n                        'r:id': 'rId1'\n                    }\n                }\n            });\n        }\n        return children;\n    };\n};\nvar worksheetFactory = {\n    getTemplate: function (params) {\n        var worksheet = params.worksheet, currentSheet = params.currentSheet, _a = params.margins, margins = _a === void 0 ? {} : _a, pageSetup = params.pageSetup, headerFooterConfig = params.headerFooterConfig;\n        var table = worksheet.table;\n        var rows = table.rows, columns = table.columns;\n        var mergedCells = (columns && columns.length) ? getMergedCells(rows, columns) : [];\n        var createWorksheetChildren = _.compose(addColumns(columns), addSheetData(rows, currentSheet + 1), addMergeCells(mergedCells), addPageMargins(margins), addPageSetup(pageSetup), addHeaderFooter(headerFooterConfig), addDrawingRel(currentSheet));\n        var children = createWorksheetChildren([]);\n        return {\n            name: \"worksheet\",\n            properties: {\n                prefixedAttributes: [{\n                        prefix: \"xmlns:\",\n                        map: {\n                            r: \"http://schemas.openxmlformats.org/officeDocument/2006/relationships\"\n                        }\n                    }],\n                rawMap: {\n                    xmlns: \"http://schemas.openxmlformats.org/spreadsheetml/2006/main\"\n                }\n            },\n            children: children\n        };\n    }\n};\nexport default worksheetFactory;\n"]},"metadata":{},"sourceType":"module"}