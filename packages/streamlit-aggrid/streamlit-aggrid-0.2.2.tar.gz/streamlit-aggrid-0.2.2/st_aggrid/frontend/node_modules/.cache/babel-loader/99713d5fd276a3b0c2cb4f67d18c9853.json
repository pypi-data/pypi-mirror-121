{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nimport { Bean, BeanStub, Autowired, _ } from \"@ag-grid-community/core\";\n\nvar AggregationStage = function (_super) {\n  __extends(AggregationStage, _super);\n\n  function AggregationStage() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  } // it's possible to recompute the aggregate without doing the other parts\n  // + gridApi.recomputeAggregates()\n\n\n  AggregationStage.prototype.execute = function (params) {\n    // if changed path is active, it means we came from a) change detection or b) transaction update.\n    // for both of these, if no value columns are present, it means there is nothing to aggregate now\n    // and there is no cleanup to be done (as value columns don't change between transactions or change\n    // detections). if no value columns and no changed path, means we have to go through all nodes in\n    // case we need to clean up agg data from before.\n    var noValueColumns = _.missingOrEmpty(this.columnModel.getValueColumns());\n\n    var noUserAgg = !this.gridOptionsWrapper.getGroupRowAggNodesFunc();\n    var changedPathActive = params.changedPath && params.changedPath.isActive();\n\n    if (noValueColumns && noUserAgg && changedPathActive) {\n      return;\n    }\n\n    var aggDetails = this.createAggDetails(params);\n    this.recursivelyCreateAggData(aggDetails);\n  };\n\n  AggregationStage.prototype.createAggDetails = function (params) {\n    var pivotActive = this.columnModel.isPivotActive();\n    var measureColumns = this.columnModel.getValueColumns();\n    var pivotColumns = pivotActive ? this.columnModel.getPivotColumns() : [];\n    var aggDetails = {\n      changedPath: params.changedPath,\n      valueColumns: measureColumns,\n      pivotColumns: pivotColumns\n    };\n    return aggDetails;\n  };\n\n  AggregationStage.prototype.recursivelyCreateAggData = function (aggDetails) {\n    var _this = this; // update prop, in case changed since last time\n\n\n    this.filteredOnly = !this.gridOptionsWrapper.isSuppressAggFilteredOnly();\n\n    var callback = function (rowNode) {\n      var hasNoChildren = !rowNode.hasChildren();\n\n      if (hasNoChildren) {\n        // this check is needed for TreeData, in case the node is no longer a child,\n        // but it was a child previously.\n        if (rowNode.aggData) {\n          rowNode.setAggData(null);\n        } // never agg data for leaf nodes\n\n\n        return;\n      } //Optionally prevent the aggregation at the root Node\n      //https://ag-grid.atlassian.net/browse/AG-388\n\n\n      var isRootNode = rowNode.level === -1;\n\n      if (isRootNode) {\n        var notPivoting = !_this.columnModel.isPivotMode();\n\n        var suppressAggAtRootLevel = _this.gridOptionsWrapper.isSuppressAggAtRootLevel();\n\n        if (suppressAggAtRootLevel && notPivoting) {\n          return;\n        }\n      }\n\n      _this.aggregateRowNode(rowNode, aggDetails);\n    };\n\n    aggDetails.changedPath.forEachChangedNodeDepthFirst(callback, true);\n  };\n\n  AggregationStage.prototype.aggregateRowNode = function (rowNode, aggDetails) {\n    var measureColumnsMissing = aggDetails.valueColumns.length === 0;\n    var pivotColumnsMissing = aggDetails.pivotColumns.length === 0;\n    var userFunc = this.gridOptionsWrapper.getGroupRowAggNodesFunc();\n    var aggResult;\n\n    if (userFunc) {\n      aggResult = userFunc(rowNode.childrenAfterFilter);\n    } else if (measureColumnsMissing) {\n      aggResult = null;\n    } else if (pivotColumnsMissing) {\n      aggResult = this.aggregateRowNodeUsingValuesOnly(rowNode, aggDetails);\n    } else {\n      aggResult = this.aggregateRowNodeUsingValuesAndPivot(rowNode);\n    }\n\n    rowNode.setAggData(aggResult); // if we are grouping, then it's possible there is a sibling footer\n    // to the group, so update the data here also if there is one\n\n    if (rowNode.sibling) {\n      rowNode.sibling.setAggData(aggResult);\n    }\n  };\n\n  AggregationStage.prototype.aggregateRowNodeUsingValuesAndPivot = function (rowNode) {\n    var _this = this;\n\n    var result = {};\n    var pivotColumnDefs = this.pivotStage.getPivotColumnDefs(); // Step 1: process value columns\n\n    pivotColumnDefs.filter(function (v) {\n      return !_.exists(v.pivotTotalColumnIds);\n    }) // only process pivot value columns\n    .forEach(function (valueColDef) {\n      var keys = valueColDef.pivotKeys || [];\n      var values;\n      var valueColumn = valueColDef.pivotValueColumn;\n      var colId = valueColDef.colId;\n\n      if (rowNode.leafGroup) {\n        // lowest level group, get the values from the mapped set\n        values = _this.getValuesFromMappedSet(rowNode.childrenMapped, keys, valueColumn);\n      } else {\n        // value columns and pivot columns, non-leaf group\n        values = _this.getValuesPivotNonLeaf(rowNode, colId);\n      }\n\n      result[colId] = _this.aggregateValues(values, valueColumn.getAggFunc(), valueColumn, rowNode);\n    }); // Step 2: process total columns\n\n    pivotColumnDefs.filter(function (v) {\n      return _.exists(v.pivotTotalColumnIds);\n    }) // only process pivot total columns\n    .forEach(function (totalColDef) {\n      var aggResults = [];\n      var pivotValueColumn = totalColDef.pivotValueColumn,\n          pivotTotalColumnIds = totalColDef.pivotTotalColumnIds,\n          colId = totalColDef.colId; //retrieve results for colIds associated with this pivot total column\n\n      if (!pivotTotalColumnIds || !pivotTotalColumnIds.length) {\n        return;\n      }\n\n      pivotTotalColumnIds.forEach(function (currentColId) {\n        aggResults.push(result[currentColId]);\n      });\n      result[colId] = _this.aggregateValues(aggResults, pivotValueColumn.getAggFunc(), pivotValueColumn, rowNode);\n    });\n    return result;\n  };\n\n  AggregationStage.prototype.aggregateRowNodeUsingValuesOnly = function (rowNode, aggDetails) {\n    var _this = this;\n\n    var result = {};\n    var changedValueColumns = aggDetails.changedPath.isActive() ? aggDetails.changedPath.getValueColumnsForNode(rowNode, aggDetails.valueColumns) : aggDetails.valueColumns;\n    var notChangedValueColumns = aggDetails.changedPath.isActive() ? aggDetails.changedPath.getNotValueColumnsForNode(rowNode, aggDetails.valueColumns) : null;\n    var values2d = this.getValuesNormal(rowNode, changedValueColumns);\n    var oldValues = rowNode.aggData;\n    changedValueColumns.forEach(function (valueColumn, index) {\n      result[valueColumn.getId()] = _this.aggregateValues(values2d[index], valueColumn.getAggFunc(), valueColumn, rowNode);\n    });\n\n    if (notChangedValueColumns && oldValues) {\n      notChangedValueColumns.forEach(function (valueColumn) {\n        result[valueColumn.getId()] = oldValues[valueColumn.getId()];\n      });\n    }\n\n    return result;\n  };\n\n  AggregationStage.prototype.getValuesPivotNonLeaf = function (rowNode, colId) {\n    var values = [];\n    rowNode.childrenAfterFilter.forEach(function (node) {\n      var value = node.aggData[colId];\n      values.push(value);\n    });\n    return values;\n  };\n\n  AggregationStage.prototype.getValuesFromMappedSet = function (mappedSet, keys, valueColumn) {\n    var _this = this;\n\n    var mapPointer = mappedSet;\n    keys.forEach(function (key) {\n      return mapPointer = mapPointer ? mapPointer[key] : null;\n    });\n\n    if (!mapPointer) {\n      return [];\n    }\n\n    var values = [];\n    mapPointer.forEach(function (rowNode) {\n      var value = _this.valueService.getValue(valueColumn, rowNode);\n\n      values.push(value);\n    });\n    return values;\n  };\n\n  AggregationStage.prototype.getValuesNormal = function (rowNode, valueColumns) {\n    // create 2d array, of all values for all valueColumns\n    var values = [];\n    valueColumns.forEach(function () {\n      return values.push([]);\n    });\n    var valueColumnCount = valueColumns.length;\n    var nodeList = this.filteredOnly ? rowNode.childrenAfterFilter : rowNode.childrenAfterGroup;\n    var rowCount = nodeList.length;\n\n    for (var i = 0; i < rowCount; i++) {\n      var childNode = nodeList[i];\n\n      for (var j = 0; j < valueColumnCount; j++) {\n        var valueColumn = valueColumns[j]; // if the row is a group, then it will only have an agg result value,\n        // which means valueGetter is never used.\n\n        var value = this.valueService.getValue(valueColumn, childNode);\n        values[j].push(value);\n      }\n    }\n\n    return values;\n  };\n\n  AggregationStage.prototype.aggregateValues = function (values, aggFuncOrString, column, rowNode) {\n    var aggFunc = typeof aggFuncOrString === 'string' ? this.aggFuncService.getAggFunc(aggFuncOrString) : aggFuncOrString;\n\n    if (typeof aggFunc !== 'function') {\n      console.error(\"AG Grid: unrecognised aggregation function \" + aggFuncOrString);\n      return null;\n    }\n\n    var deprecationWarning = function () {\n      _.doOnce(function () {\n        console.warn('AG Grid: since v24.0, custom aggregation functions take a params object. Please alter your aggregation function to use params.values');\n      }, 'aggregationStage.aggregateValues Deprecation');\n    };\n\n    var aggFuncAny = aggFunc;\n    var params = {\n      values: values,\n      column: column,\n      colDef: column ? column.getColDef() : undefined,\n      rowNode: rowNode,\n      data: rowNode ? rowNode.data : undefined,\n      api: this.gridApi,\n      columnApi: this.columnApi,\n      context: this.gridOptionsWrapper.getContext(),\n      // the three things below are for logging warning messages in case anyone is treating\n      // the params object as an array. in previous grid versions, we didn't pass params object,\n      // but passed values array instead.\n      forEach: function (callback, thisArg) {\n        deprecationWarning();\n        return values.forEach(callback, thisArg);\n      },\n\n      get length() {\n        deprecationWarning();\n        return values.length;\n      },\n\n      set length(val) {\n        deprecationWarning();\n        values.length = val;\n      }\n\n    }; // the \"as any\" is needed to allow the deprecation warning messages\n\n    return aggFuncAny(params);\n  };\n\n  __decorate([Autowired('columnModel')], AggregationStage.prototype, \"columnModel\", void 0);\n\n  __decorate([Autowired('valueService')], AggregationStage.prototype, \"valueService\", void 0);\n\n  __decorate([Autowired('pivotStage')], AggregationStage.prototype, \"pivotStage\", void 0);\n\n  __decorate([Autowired('aggFuncService')], AggregationStage.prototype, \"aggFuncService\", void 0);\n\n  __decorate([Autowired('gridApi')], AggregationStage.prototype, \"gridApi\", void 0);\n\n  __decorate([Autowired('columnApi')], AggregationStage.prototype, \"columnApi\", void 0);\n\n  AggregationStage = __decorate([Bean('aggregationStage')], AggregationStage);\n  return AggregationStage;\n}(BeanStub);\n\nexport { AggregationStage };","map":{"version":3,"sources":["C:/dev/streamlit-aggrid/st_aggrid/frontend/node_modules/@ag-grid-enterprise/row-grouping/dist/es6/rowGrouping/aggregationStage.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__decorate","decorators","target","key","desc","c","arguments","length","r","getOwnPropertyDescriptor","Reflect","decorate","i","defineProperty","Bean","BeanStub","Autowired","_","AggregationStage","_super","apply","execute","params","noValueColumns","missingOrEmpty","columnModel","getValueColumns","noUserAgg","gridOptionsWrapper","getGroupRowAggNodesFunc","changedPathActive","changedPath","isActive","aggDetails","createAggDetails","recursivelyCreateAggData","pivotActive","isPivotActive","measureColumns","pivotColumns","getPivotColumns","valueColumns","_this","filteredOnly","isSuppressAggFilteredOnly","callback","rowNode","hasNoChildren","hasChildren","aggData","setAggData","isRootNode","level","notPivoting","isPivotMode","suppressAggAtRootLevel","isSuppressAggAtRootLevel","aggregateRowNode","forEachChangedNodeDepthFirst","measureColumnsMissing","pivotColumnsMissing","userFunc","aggResult","childrenAfterFilter","aggregateRowNodeUsingValuesOnly","aggregateRowNodeUsingValuesAndPivot","sibling","result","pivotColumnDefs","pivotStage","getPivotColumnDefs","filter","v","exists","pivotTotalColumnIds","forEach","valueColDef","keys","pivotKeys","values","valueColumn","pivotValueColumn","colId","leafGroup","getValuesFromMappedSet","childrenMapped","getValuesPivotNonLeaf","aggregateValues","getAggFunc","totalColDef","aggResults","currentColId","push","changedValueColumns","getValueColumnsForNode","notChangedValueColumns","getNotValueColumnsForNode","values2d","getValuesNormal","oldValues","index","getId","node","value","mappedSet","mapPointer","valueService","getValue","valueColumnCount","nodeList","childrenAfterGroup","rowCount","childNode","j","aggFuncOrString","column","aggFunc","aggFuncService","console","error","deprecationWarning","doOnce","warn","aggFuncAny","colDef","getColDef","undefined","data","api","gridApi","columnApi","context","getContext","thisArg","val"],"mappings":"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","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nimport { Bean, BeanStub, Autowired, _ } from \"@ag-grid-community/core\";\nvar AggregationStage = /** @class */ (function (_super) {\n    __extends(AggregationStage, _super);\n    function AggregationStage() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    // it's possible to recompute the aggregate without doing the other parts\n    // + gridApi.recomputeAggregates()\n    AggregationStage.prototype.execute = function (params) {\n        // if changed path is active, it means we came from a) change detection or b) transaction update.\n        // for both of these, if no value columns are present, it means there is nothing to aggregate now\n        // and there is no cleanup to be done (as value columns don't change between transactions or change\n        // detections). if no value columns and no changed path, means we have to go through all nodes in\n        // case we need to clean up agg data from before.\n        var noValueColumns = _.missingOrEmpty(this.columnModel.getValueColumns());\n        var noUserAgg = !this.gridOptionsWrapper.getGroupRowAggNodesFunc();\n        var changedPathActive = params.changedPath && params.changedPath.isActive();\n        if (noValueColumns && noUserAgg && changedPathActive) {\n            return;\n        }\n        var aggDetails = this.createAggDetails(params);\n        this.recursivelyCreateAggData(aggDetails);\n    };\n    AggregationStage.prototype.createAggDetails = function (params) {\n        var pivotActive = this.columnModel.isPivotActive();\n        var measureColumns = this.columnModel.getValueColumns();\n        var pivotColumns = pivotActive ? this.columnModel.getPivotColumns() : [];\n        var aggDetails = {\n            changedPath: params.changedPath,\n            valueColumns: measureColumns,\n            pivotColumns: pivotColumns\n        };\n        return aggDetails;\n    };\n    AggregationStage.prototype.recursivelyCreateAggData = function (aggDetails) {\n        var _this = this;\n        // update prop, in case changed since last time\n        this.filteredOnly = !this.gridOptionsWrapper.isSuppressAggFilteredOnly();\n        var callback = function (rowNode) {\n            var hasNoChildren = !rowNode.hasChildren();\n            if (hasNoChildren) {\n                // this check is needed for TreeData, in case the node is no longer a child,\n                // but it was a child previously.\n                if (rowNode.aggData) {\n                    rowNode.setAggData(null);\n                }\n                // never agg data for leaf nodes\n                return;\n            }\n            //Optionally prevent the aggregation at the root Node\n            //https://ag-grid.atlassian.net/browse/AG-388\n            var isRootNode = rowNode.level === -1;\n            if (isRootNode) {\n                var notPivoting = !_this.columnModel.isPivotMode();\n                var suppressAggAtRootLevel = _this.gridOptionsWrapper.isSuppressAggAtRootLevel();\n                if (suppressAggAtRootLevel && notPivoting) {\n                    return;\n                }\n            }\n            _this.aggregateRowNode(rowNode, aggDetails);\n        };\n        aggDetails.changedPath.forEachChangedNodeDepthFirst(callback, true);\n    };\n    AggregationStage.prototype.aggregateRowNode = function (rowNode, aggDetails) {\n        var measureColumnsMissing = aggDetails.valueColumns.length === 0;\n        var pivotColumnsMissing = aggDetails.pivotColumns.length === 0;\n        var userFunc = this.gridOptionsWrapper.getGroupRowAggNodesFunc();\n        var aggResult;\n        if (userFunc) {\n            aggResult = userFunc(rowNode.childrenAfterFilter);\n        }\n        else if (measureColumnsMissing) {\n            aggResult = null;\n        }\n        else if (pivotColumnsMissing) {\n            aggResult = this.aggregateRowNodeUsingValuesOnly(rowNode, aggDetails);\n        }\n        else {\n            aggResult = this.aggregateRowNodeUsingValuesAndPivot(rowNode);\n        }\n        rowNode.setAggData(aggResult);\n        // if we are grouping, then it's possible there is a sibling footer\n        // to the group, so update the data here also if there is one\n        if (rowNode.sibling) {\n            rowNode.sibling.setAggData(aggResult);\n        }\n    };\n    AggregationStage.prototype.aggregateRowNodeUsingValuesAndPivot = function (rowNode) {\n        var _this = this;\n        var result = {};\n        var pivotColumnDefs = this.pivotStage.getPivotColumnDefs();\n        // Step 1: process value columns\n        pivotColumnDefs\n            .filter(function (v) { return !_.exists(v.pivotTotalColumnIds); }) // only process pivot value columns\n            .forEach(function (valueColDef) {\n            var keys = valueColDef.pivotKeys || [];\n            var values;\n            var valueColumn = valueColDef.pivotValueColumn;\n            var colId = valueColDef.colId;\n            if (rowNode.leafGroup) {\n                // lowest level group, get the values from the mapped set\n                values = _this.getValuesFromMappedSet(rowNode.childrenMapped, keys, valueColumn);\n            }\n            else {\n                // value columns and pivot columns, non-leaf group\n                values = _this.getValuesPivotNonLeaf(rowNode, colId);\n            }\n            result[colId] = _this.aggregateValues(values, valueColumn.getAggFunc(), valueColumn, rowNode);\n        });\n        // Step 2: process total columns\n        pivotColumnDefs\n            .filter(function (v) { return _.exists(v.pivotTotalColumnIds); }) // only process pivot total columns\n            .forEach(function (totalColDef) {\n            var aggResults = [];\n            var pivotValueColumn = totalColDef.pivotValueColumn, pivotTotalColumnIds = totalColDef.pivotTotalColumnIds, colId = totalColDef.colId;\n            //retrieve results for colIds associated with this pivot total column\n            if (!pivotTotalColumnIds || !pivotTotalColumnIds.length) {\n                return;\n            }\n            pivotTotalColumnIds.forEach(function (currentColId) {\n                aggResults.push(result[currentColId]);\n            });\n            result[colId] = _this.aggregateValues(aggResults, pivotValueColumn.getAggFunc(), pivotValueColumn, rowNode);\n        });\n        return result;\n    };\n    AggregationStage.prototype.aggregateRowNodeUsingValuesOnly = function (rowNode, aggDetails) {\n        var _this = this;\n        var result = {};\n        var changedValueColumns = aggDetails.changedPath.isActive() ?\n            aggDetails.changedPath.getValueColumnsForNode(rowNode, aggDetails.valueColumns)\n            : aggDetails.valueColumns;\n        var notChangedValueColumns = aggDetails.changedPath.isActive() ?\n            aggDetails.changedPath.getNotValueColumnsForNode(rowNode, aggDetails.valueColumns)\n            : null;\n        var values2d = this.getValuesNormal(rowNode, changedValueColumns);\n        var oldValues = rowNode.aggData;\n        changedValueColumns.forEach(function (valueColumn, index) {\n            result[valueColumn.getId()] = _this.aggregateValues(values2d[index], valueColumn.getAggFunc(), valueColumn, rowNode);\n        });\n        if (notChangedValueColumns && oldValues) {\n            notChangedValueColumns.forEach(function (valueColumn) {\n                result[valueColumn.getId()] = oldValues[valueColumn.getId()];\n            });\n        }\n        return result;\n    };\n    AggregationStage.prototype.getValuesPivotNonLeaf = function (rowNode, colId) {\n        var values = [];\n        rowNode.childrenAfterFilter.forEach(function (node) {\n            var value = node.aggData[colId];\n            values.push(value);\n        });\n        return values;\n    };\n    AggregationStage.prototype.getValuesFromMappedSet = function (mappedSet, keys, valueColumn) {\n        var _this = this;\n        var mapPointer = mappedSet;\n        keys.forEach(function (key) { return (mapPointer = mapPointer ? mapPointer[key] : null); });\n        if (!mapPointer) {\n            return [];\n        }\n        var values = [];\n        mapPointer.forEach(function (rowNode) {\n            var value = _this.valueService.getValue(valueColumn, rowNode);\n            values.push(value);\n        });\n        return values;\n    };\n    AggregationStage.prototype.getValuesNormal = function (rowNode, valueColumns) {\n        // create 2d array, of all values for all valueColumns\n        var values = [];\n        valueColumns.forEach(function () { return values.push([]); });\n        var valueColumnCount = valueColumns.length;\n        var nodeList = this.filteredOnly ? rowNode.childrenAfterFilter : rowNode.childrenAfterGroup;\n        var rowCount = nodeList.length;\n        for (var i = 0; i < rowCount; i++) {\n            var childNode = nodeList[i];\n            for (var j = 0; j < valueColumnCount; j++) {\n                var valueColumn = valueColumns[j];\n                // if the row is a group, then it will only have an agg result value,\n                // which means valueGetter is never used.\n                var value = this.valueService.getValue(valueColumn, childNode);\n                values[j].push(value);\n            }\n        }\n        return values;\n    };\n    AggregationStage.prototype.aggregateValues = function (values, aggFuncOrString, column, rowNode) {\n        var aggFunc = typeof aggFuncOrString === 'string' ?\n            this.aggFuncService.getAggFunc(aggFuncOrString) :\n            aggFuncOrString;\n        if (typeof aggFunc !== 'function') {\n            console.error(\"AG Grid: unrecognised aggregation function \" + aggFuncOrString);\n            return null;\n        }\n        var deprecationWarning = function () {\n            _.doOnce(function () {\n                console.warn('AG Grid: since v24.0, custom aggregation functions take a params object. Please alter your aggregation function to use params.values');\n            }, 'aggregationStage.aggregateValues Deprecation');\n        };\n        var aggFuncAny = aggFunc;\n        var params = {\n            values: values,\n            column: column,\n            colDef: column ? column.getColDef() : undefined,\n            rowNode: rowNode,\n            data: rowNode ? rowNode.data : undefined,\n            api: this.gridApi,\n            columnApi: this.columnApi,\n            context: this.gridOptionsWrapper.getContext(),\n            // the three things below are for logging warning messages in case anyone is treating\n            // the params object as an array. in previous grid versions, we didn't pass params object,\n            // but passed values array instead.\n            forEach: function (callback, thisArg) {\n                deprecationWarning();\n                return values.forEach(callback, thisArg);\n            },\n            get length() {\n                deprecationWarning();\n                return values.length;\n            },\n            set length(val) {\n                deprecationWarning();\n                values.length = val;\n            }\n        }; // the \"as any\" is needed to allow the deprecation warning messages\n        return aggFuncAny(params);\n    };\n    __decorate([\n        Autowired('columnModel')\n    ], AggregationStage.prototype, \"columnModel\", void 0);\n    __decorate([\n        Autowired('valueService')\n    ], AggregationStage.prototype, \"valueService\", void 0);\n    __decorate([\n        Autowired('pivotStage')\n    ], AggregationStage.prototype, \"pivotStage\", void 0);\n    __decorate([\n        Autowired('aggFuncService')\n    ], AggregationStage.prototype, \"aggFuncService\", void 0);\n    __decorate([\n        Autowired('gridApi')\n    ], AggregationStage.prototype, \"gridApi\", void 0);\n    __decorate([\n        Autowired('columnApi')\n    ], AggregationStage.prototype, \"columnApi\", void 0);\n    AggregationStage = __decorate([\n        Bean('aggregationStage')\n    ], AggregationStage);\n    return AggregationStage;\n}(BeanStub));\nexport { AggregationStage };\n"]},"metadata":{},"sourceType":"module"}