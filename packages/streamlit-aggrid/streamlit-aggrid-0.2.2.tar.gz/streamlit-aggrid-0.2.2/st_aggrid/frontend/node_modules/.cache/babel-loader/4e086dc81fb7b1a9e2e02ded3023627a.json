{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nimport { Group } from \"../scene/group\";\nimport { Selection } from \"../scene/selection\";\nimport { MarkerLabel } from \"./markerLabel\";\nimport { reactive, Observable } from \"../util/observable\";\nimport { getMarker } from \"./marker/util\";\nimport { createId } from \"../util/id\";\nexport var LegendOrientation;\n\n(function (LegendOrientation) {\n  LegendOrientation[LegendOrientation[\"Vertical\"] = 0] = \"Vertical\";\n  LegendOrientation[LegendOrientation[\"Horizontal\"] = 1] = \"Horizontal\";\n})(LegendOrientation || (LegendOrientation = {}));\n\nexport var LegendPosition;\n\n(function (LegendPosition) {\n  LegendPosition[\"Top\"] = \"top\";\n  LegendPosition[\"Right\"] = \"right\";\n  LegendPosition[\"Bottom\"] = \"bottom\";\n  LegendPosition[\"Left\"] = \"left\";\n})(LegendPosition || (LegendPosition = {}));\n\nvar LegendLabel = function (_super) {\n  __extends(LegendLabel, _super);\n\n  function LegendLabel() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.color = 'black';\n    _this.fontSize = 12;\n    _this.fontFamily = 'Verdana, sans-serif';\n    return _this;\n  }\n\n  __decorate([reactive('change')], LegendLabel.prototype, \"color\", void 0);\n\n  __decorate([reactive('layoutChange')], LegendLabel.prototype, \"fontStyle\", void 0);\n\n  __decorate([reactive('layoutChange')], LegendLabel.prototype, \"fontWeight\", void 0);\n\n  __decorate([reactive('layoutChange')], LegendLabel.prototype, \"fontSize\", void 0);\n\n  __decorate([reactive('layoutChange')], LegendLabel.prototype, \"fontFamily\", void 0);\n\n  __decorate([reactive()], LegendLabel.prototype, \"formatter\", void 0);\n\n  return LegendLabel;\n}(Observable);\n\nexport { LegendLabel };\n\nvar LegendMarker = function (_super) {\n  __extends(LegendMarker, _super);\n\n  function LegendMarker() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.size = 15;\n    /**\n     * Padding between the marker and the label within each legend item.\n     */\n\n    _this.padding = 8;\n    _this.strokeWidth = 1;\n    return _this;\n  }\n\n  __decorate([reactive('layoutChange')], LegendMarker.prototype, \"size\", void 0);\n\n  __decorate([reactive('layoutChange')], LegendMarker.prototype, \"shape\", void 0);\n\n  __decorate([reactive('layoutChange')], LegendMarker.prototype, \"padding\", void 0);\n\n  __decorate([reactive('change')], LegendMarker.prototype, \"strokeWidth\", void 0);\n\n  return LegendMarker;\n}(Observable);\n\nexport { LegendMarker };\n\nvar LegendItem = function (_super) {\n  __extends(LegendItem, _super);\n\n  function LegendItem() {\n    var _this = _super.call(this) || this;\n\n    _this.marker = new LegendMarker();\n    _this.label = new LegendLabel();\n    /**\n     * The legend uses grid layout for its items, occupying as few columns as possible when positioned to left or right,\n     * and as few rows as possible when positioned to top or bottom. This config specifies the amount of horizontal\n     * padding between legend items.\n     */\n\n    _this.paddingX = 16;\n    /**\n     * The legend uses grid layout for its items, occupying as few columns as possible when positioned to left or right,\n     * and as few rows as possible when positioned to top or bottom. This config specifies the amount of vertical\n     * padding between legend items.\n     */\n\n    _this.paddingY = 8;\n\n    var changeListener = function () {\n      return _this.fireEvent({\n        type: 'change'\n      });\n    };\n\n    _this.marker.addEventListener('change', changeListener);\n\n    _this.label.addEventListener('change', changeListener);\n\n    var layoutChangeListener = function () {\n      return _this.fireEvent({\n        type: 'layoutChange'\n      });\n    };\n\n    _this.marker.addEventListener('layoutChange', layoutChangeListener);\n\n    _this.label.addEventListener('layoutChange', layoutChangeListener);\n\n    return _this;\n  }\n\n  __decorate([reactive('layoutChange')], LegendItem.prototype, \"paddingX\", void 0);\n\n  __decorate([reactive('layoutChange')], LegendItem.prototype, \"paddingY\", void 0);\n\n  return LegendItem;\n}(Observable);\n\nexport { LegendItem };\n\nvar Legend = function (_super) {\n  __extends(Legend, _super);\n\n  function Legend() {\n    var _this = _super.call(this) || this;\n\n    _this.id = createId(_this);\n    _this.group = new Group();\n    _this.itemSelection = Selection.select(_this.group).selectAll();\n    _this.oldSize = [0, 0];\n    _this.item = new LegendItem();\n    _this.data = [];\n    _this.enabled = true;\n    _this.orientation = LegendOrientation.Vertical;\n    _this.position = LegendPosition.Right;\n    /**\n     * Spacing between the legend and the edge of the chart's element.\n     */\n\n    _this.spacing = 20;\n    _this._size = [0, 0];\n\n    _this.addPropertyListener('data', _this.onDataChange);\n\n    _this.addPropertyListener('enabled', _this.onEnabledChange);\n\n    _this.addPropertyListener('position', _this.onPositionChange);\n\n    _this.item.marker.addPropertyListener('shape', _this.onMarkerShapeChange, _this);\n\n    _this.addEventListener('change', _this.update);\n\n    _this.item.addEventListener('change', function () {\n      return _this.fireEvent({\n        type: 'change'\n      });\n    });\n\n    _this.item.addEventListener('layoutChange', function () {\n      return _this.fireEvent({\n        type: 'layoutChange'\n      });\n    });\n\n    return _this;\n  }\n\n  Object.defineProperty(Legend.prototype, \"size\", {\n    get: function () {\n      return this._size;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  Legend.prototype.onDataChange = function (event) {\n    this.group.visible = event.value.length > 0 && this.enabled;\n  };\n\n  Legend.prototype.onEnabledChange = function (event) {\n    this.group.visible = event.value && this.data.length > 0;\n  };\n\n  Legend.prototype.onPositionChange = function (event) {\n    switch (event.value) {\n      case 'right':\n      case 'left':\n        this.orientation = LegendOrientation.Vertical;\n        break;\n\n      case 'bottom':\n      case 'top':\n        this.orientation = LegendOrientation.Horizontal;\n        break;\n    }\n  };\n\n  Legend.prototype.onMarkerShapeChange = function () {\n    this.itemSelection = this.itemSelection.setData([]);\n    this.itemSelection.exit.remove();\n\n    if (this.group.scene) {\n      this.group.scene.cancelRender();\n    }\n  };\n  /**\n   * The method is given the desired size of the legend, which only serves as a hint.\n   * The vertically oriented legend will take as much horizontal space as needed, but will\n   * respect the height constraints, and the horizontal legend will take as much vertical\n   * space as needed in an attempt not to exceed the given width.\n   * After the layout is done, the {@link size} will contain the actual size of the legend.\n   * If the actual size is not the same as the previous actual size, the legend will fire\n   * the 'layoutChange' event to communicate that another layout is needed, and the above\n   * process should be repeated.\n   * @param width\n   * @param height\n   */\n\n\n  Legend.prototype.performLayout = function (width, height) {\n    var item = this.item;\n    var marker = item.marker,\n        paddingX = item.paddingX,\n        paddingY = item.paddingY;\n    var updateSelection = this.itemSelection.setData(this.data, function (_, datum) {\n      var MarkerShape = getMarker(marker.shape || datum.marker.shape);\n      return datum.id + '-' + datum.itemId + '-' + MarkerShape.name;\n    });\n    updateSelection.exit.remove();\n    var enterSelection = updateSelection.enter.append(MarkerLabel).each(function (node, datum) {\n      var MarkerShape = getMarker(marker.shape || datum.marker.shape);\n      node.marker = new MarkerShape();\n    });\n    var itemSelection = this.itemSelection = updateSelection.merge(enterSelection);\n    var itemCount = itemSelection.size; // Update properties that affect the size of the legend items and measure them.\n\n    var bboxes = [];\n    var itemMarker = this.item.marker;\n    var itemLabel = this.item.label;\n    itemSelection.each(function (markerLabel, datum) {\n      // TODO: measure only when one of these properties or data change (in a separate routine)\n      markerLabel.markerSize = itemMarker.size;\n      markerLabel.spacing = itemMarker.padding;\n      markerLabel.fontStyle = itemLabel.fontStyle;\n      markerLabel.fontWeight = itemLabel.fontWeight;\n      markerLabel.fontSize = itemLabel.fontSize;\n      markerLabel.fontFamily = itemLabel.fontFamily;\n      markerLabel.text = datum.label.text;\n      bboxes.push(markerLabel.computeBBox());\n    });\n    var itemHeight = bboxes.length && bboxes[0].height;\n    var rowCount = 0;\n    var columnWidth = 0;\n    var paddedItemsWidth = 0;\n    var paddedItemsHeight = 0;\n\n    switch (this.orientation) {\n      case LegendOrientation.Horizontal:\n        if (!(isFinite(width) && width > 0)) {\n          return false;\n        }\n\n        rowCount = 0;\n        var columnCount = 0; // Split legend items into columns until the width is suitable.\n\n        do {\n          var itemsWidth = 0;\n          columnCount = 0;\n          columnWidth = 0;\n          rowCount++;\n          var i = 0;\n\n          while (i < itemCount) {\n            var bbox = bboxes[i];\n\n            if (bbox.width > columnWidth) {\n              columnWidth = bbox.width;\n            }\n\n            i++;\n\n            if (i % rowCount === 0) {\n              itemsWidth += columnWidth;\n              columnWidth = 0;\n              columnCount++;\n            }\n          }\n\n          if (i % rowCount !== 0) {\n            itemsWidth += columnWidth;\n            columnCount++;\n          }\n\n          paddedItemsWidth = itemsWidth + (columnCount - 1) * paddingX;\n        } while (paddedItemsWidth > width && columnCount > 1);\n\n        paddedItemsHeight = itemHeight * rowCount + (rowCount - 1) * paddingY;\n        break;\n\n      case LegendOrientation.Vertical:\n        if (!(isFinite(height) && height > 0)) {\n          return false;\n        }\n\n        rowCount = itemCount * 2; // Split legend items into columns until the height is suitable.\n\n        do {\n          rowCount = (rowCount >> 1) + rowCount % 2;\n          columnWidth = 0;\n          var itemsWidth = 0;\n          var itemsHeight = 0;\n          var columnCount_1 = 0;\n          var i = 0;\n\n          while (i < itemCount) {\n            var bbox = bboxes[i];\n\n            if (!columnCount_1) {\n              itemsHeight += bbox.height;\n            }\n\n            if (bbox.width > columnWidth) {\n              columnWidth = bbox.width;\n            }\n\n            i++;\n\n            if (i % rowCount === 0) {\n              itemsWidth += columnWidth;\n              columnWidth = 0;\n              columnCount_1++;\n            }\n          }\n\n          if (i % rowCount !== 0) {\n            itemsWidth += columnWidth;\n            columnCount_1++;\n          }\n\n          paddedItemsWidth = itemsWidth + (columnCount_1 - 1) * paddingX;\n          paddedItemsHeight = itemsHeight + (rowCount - 1) * paddingY;\n        } while (paddedItemsHeight > height && rowCount > 1);\n\n        break;\n    } // Top-left corner of the first legend item.\n\n\n    var startX = (width - paddedItemsWidth) / 2;\n    var startY = (height - paddedItemsHeight) / 2;\n    var x = 0;\n    var y = 0;\n    columnWidth = 0; // Position legend items using the layout computed above.\n\n    itemSelection.each(function (markerLabel, datum, i) {\n      // Round off for pixel grid alignment to work properly.\n      markerLabel.translationX = Math.floor(startX + x);\n      markerLabel.translationY = Math.floor(startY + y);\n      var bbox = bboxes[i];\n\n      if (bbox.width > columnWidth) {\n        columnWidth = bbox.width;\n      }\n\n      if ((i + 1) % rowCount === 0) {\n        x += columnWidth + paddingX;\n        y = 0;\n        columnWidth = 0;\n      } else {\n        y += bbox.height + paddingY;\n      }\n    }); // Update legend item properties that don't affect the layout.\n\n    this.update();\n    var size = this._size;\n    var oldSize = this.oldSize;\n    size[0] = paddedItemsWidth;\n    size[1] = paddedItemsHeight;\n\n    if (size[0] !== oldSize[0] || size[1] !== oldSize[1]) {\n      oldSize[0] = size[0];\n      oldSize[1] = size[1];\n    }\n  };\n\n  Legend.prototype.update = function () {\n    var _this = this;\n\n    this.itemSelection.each(function (markerLabel, datum) {\n      var marker = datum.marker;\n      markerLabel.markerFill = marker.fill;\n      markerLabel.markerStroke = marker.stroke;\n      markerLabel.markerStrokeWidth = _this.item.marker.strokeWidth;\n      markerLabel.markerFillOpacity = marker.fillOpacity;\n      markerLabel.markerStrokeOpacity = marker.strokeOpacity;\n      markerLabel.opacity = datum.enabled ? 1 : 0.5;\n      markerLabel.color = _this.item.label.color;\n    });\n  };\n\n  Legend.prototype.getDatumForPoint = function (x, y) {\n    var node = this.group.pickNode(x, y);\n\n    if (node && node.parent) {\n      return node.parent.datum;\n    }\n  };\n\n  Legend.className = 'Legend';\n\n  __decorate([reactive('layoutChange')], Legend.prototype, \"data\", void 0);\n\n  __decorate([reactive('layoutChange')], Legend.prototype, \"enabled\", void 0);\n\n  __decorate([reactive('layoutChange')], Legend.prototype, \"orientation\", void 0);\n\n  __decorate([reactive('layoutChange')], Legend.prototype, \"position\", void 0);\n\n  __decorate([reactive('layoutChange')], Legend.prototype, \"spacing\", void 0);\n\n  return Legend;\n}(Observable);\n\nexport { Legend };","map":{"version":3,"sources":["C:/dev/streamlit-aggrid/st_aggrid/frontend/node_modules/ag-charts-community/dist/es6/chart/legend.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__decorate","decorators","target","key","desc","c","arguments","length","r","getOwnPropertyDescriptor","Reflect","decorate","i","defineProperty","Group","Selection","MarkerLabel","reactive","Observable","getMarker","createId","LegendOrientation","LegendPosition","LegendLabel","_super","_this","apply","color","fontSize","fontFamily","LegendMarker","size","padding","strokeWidth","LegendItem","call","marker","label","paddingX","paddingY","changeListener","fireEvent","type","addEventListener","layoutChangeListener","Legend","id","group","itemSelection","select","selectAll","oldSize","item","data","enabled","orientation","Vertical","position","Right","spacing","_size","addPropertyListener","onDataChange","onEnabledChange","onPositionChange","onMarkerShapeChange","update","get","enumerable","configurable","event","visible","value","Horizontal","setData","exit","remove","scene","cancelRender","performLayout","width","height","updateSelection","_","datum","MarkerShape","shape","itemId","name","enterSelection","enter","append","each","node","merge","itemCount","bboxes","itemMarker","itemLabel","markerLabel","markerSize","fontStyle","fontWeight","text","push","computeBBox","itemHeight","rowCount","columnWidth","paddedItemsWidth","paddedItemsHeight","isFinite","columnCount","itemsWidth","bbox","itemsHeight","columnCount_1","startX","startY","x","y","translationX","Math","floor","translationY","markerFill","fill","markerStroke","stroke","markerStrokeWidth","markerFillOpacity","fillOpacity","markerStrokeOpacity","strokeOpacity","opacity","getDatumForPoint","pickNode","parent","className"],"mappings":"AAAA,IAAIA,SAAS,GAAI,QAAQ,KAAKA,SAAd,IAA6B,YAAY;AACrD,MAAIC,aAAa,GAAG,UAAUC,CAAV,EAAaC,CAAb,EAAgB;AAChCF,IAAAA,aAAa,GAAGG,MAAM,CAACC,cAAP,IACX;AAAEC,MAAAA,SAAS,EAAE;AAAb,iBAA6BC,KAA7B,IAAsC,UAAUL,CAAV,EAAaC,CAAb,EAAgB;AAAED,MAAAA,CAAC,CAACI,SAAF,GAAcH,CAAd;AAAkB,KAD/D,IAEZ,UAAUD,CAAV,EAAaC,CAAb,EAAgB;AAAE,WAAK,IAAIK,CAAT,IAAcL,CAAd,EAAiB,IAAIA,CAAC,CAACM,cAAF,CAAiBD,CAAjB,CAAJ,EAAyBN,CAAC,CAACM,CAAD,CAAD,GAAOL,CAAC,CAACK,CAAD,CAAR;AAAc,KAF9E;;AAGA,WAAOP,aAAa,CAACC,CAAD,EAAIC,CAAJ,CAApB;AACH,GALD;;AAMA,SAAO,UAAUD,CAAV,EAAaC,CAAb,EAAgB;AACnBF,IAAAA,aAAa,CAACC,CAAD,EAAIC,CAAJ,CAAb;;AACA,aAASO,EAAT,GAAc;AAAE,WAAKC,WAAL,GAAmBT,CAAnB;AAAuB;;AACvCA,IAAAA,CAAC,CAACU,SAAF,GAAcT,CAAC,KAAK,IAAN,GAAaC,MAAM,CAACS,MAAP,CAAcV,CAAd,CAAb,IAAiCO,EAAE,CAACE,SAAH,GAAeT,CAAC,CAACS,SAAjB,EAA4B,IAAIF,EAAJ,EAA7D,CAAd;AACH,GAJD;AAKH,CAZ2C,EAA5C;;AAaA,IAAII,UAAU,GAAI,QAAQ,KAAKA,UAAd,IAA6B,UAAUC,UAAV,EAAsBC,MAAtB,EAA8BC,GAA9B,EAAmCC,IAAnC,EAAyC;AACnF,MAAIC,CAAC,GAAGC,SAAS,CAACC,MAAlB;AAAA,MAA0BC,CAAC,GAAGH,CAAC,GAAG,CAAJ,GAAQH,MAAR,GAAiBE,IAAI,KAAK,IAAT,GAAgBA,IAAI,GAAGd,MAAM,CAACmB,wBAAP,CAAgCP,MAAhC,EAAwCC,GAAxC,CAAvB,GAAsEC,IAArH;AAAA,MAA2HhB,CAA3H;AACA,MAAI,OAAOsB,OAAP,KAAmB,QAAnB,IAA+B,OAAOA,OAAO,CAACC,QAAf,KAA4B,UAA/D,EAA2EH,CAAC,GAAGE,OAAO,CAACC,QAAR,CAAiBV,UAAjB,EAA6BC,MAA7B,EAAqCC,GAArC,EAA0CC,IAA1C,CAAJ,CAA3E,KACK,KAAK,IAAIQ,CAAC,GAAGX,UAAU,CAACM,MAAX,GAAoB,CAAjC,EAAoCK,CAAC,IAAI,CAAzC,EAA4CA,CAAC,EAA7C,EAAiD,IAAIxB,CAAC,GAAGa,UAAU,CAACW,CAAD,CAAlB,EAAuBJ,CAAC,GAAG,CAACH,CAAC,GAAG,CAAJ,GAAQjB,CAAC,CAACoB,CAAD,CAAT,GAAeH,CAAC,GAAG,CAAJ,GAAQjB,CAAC,CAACc,MAAD,EAASC,GAAT,EAAcK,CAAd,CAAT,GAA4BpB,CAAC,CAACc,MAAD,EAASC,GAAT,CAA7C,KAA+DK,CAAnE;AAC7E,SAAOH,CAAC,GAAG,CAAJ,IAASG,CAAT,IAAclB,MAAM,CAACuB,cAAP,CAAsBX,MAAtB,EAA8BC,GAA9B,EAAmCK,CAAnC,CAAd,EAAqDA,CAA5D;AACH,CALD;;AAMA,SAASM,KAAT,QAAsB,gBAAtB;AACA,SAASC,SAAT,QAA0B,oBAA1B;AACA,SAASC,WAAT,QAA4B,eAA5B;AACA,SAASC,QAAT,EAAmBC,UAAnB,QAAqC,oBAArC;AACA,SAASC,SAAT,QAA0B,eAA1B;AACA,SAASC,QAAT,QAAyB,YAAzB;AACA,OAAO,IAAIC,iBAAJ;;AACP,CAAC,UAAUA,iBAAV,EAA6B;AAC1BA,EAAAA,iBAAiB,CAACA,iBAAiB,CAAC,UAAD,CAAjB,GAAgC,CAAjC,CAAjB,GAAuD,UAAvD;AACAA,EAAAA,iBAAiB,CAACA,iBAAiB,CAAC,YAAD,CAAjB,GAAkC,CAAnC,CAAjB,GAAyD,YAAzD;AACH,CAHD,EAGGA,iBAAiB,KAAKA,iBAAiB,GAAG,EAAzB,CAHpB;;AAIA,OAAO,IAAIC,cAAJ;;AACP,CAAC,UAAUA,cAAV,EAA0B;AACvBA,EAAAA,cAAc,CAAC,KAAD,CAAd,GAAwB,KAAxB;AACAA,EAAAA,cAAc,CAAC,OAAD,CAAd,GAA0B,OAA1B;AACAA,EAAAA,cAAc,CAAC,QAAD,CAAd,GAA2B,QAA3B;AACAA,EAAAA,cAAc,CAAC,MAAD,CAAd,GAAyB,MAAzB;AACH,CALD,EAKGA,cAAc,KAAKA,cAAc,GAAG,EAAtB,CALjB;;AAMA,IAAIC,WAAW,GAAkB,UAAUC,MAAV,EAAkB;AAC/CtC,EAAAA,SAAS,CAACqC,WAAD,EAAcC,MAAd,CAAT;;AACA,WAASD,WAAT,GAAuB;AACnB,QAAIE,KAAK,GAAGD,MAAM,KAAK,IAAX,IAAmBA,MAAM,CAACE,KAAP,CAAa,IAAb,EAAmBpB,SAAnB,CAAnB,IAAoD,IAAhE;;AACAmB,IAAAA,KAAK,CAACE,KAAN,GAAc,OAAd;AACAF,IAAAA,KAAK,CAACG,QAAN,GAAiB,EAAjB;AACAH,IAAAA,KAAK,CAACI,UAAN,GAAmB,qBAAnB;AACA,WAAOJ,KAAP;AACH;;AACDzB,EAAAA,UAAU,CAAC,CACPiB,QAAQ,CAAC,QAAD,CADD,CAAD,EAEPM,WAAW,CAACzB,SAFL,EAEgB,OAFhB,EAEyB,KAAK,CAF9B,CAAV;;AAGAE,EAAAA,UAAU,CAAC,CACPiB,QAAQ,CAAC,cAAD,CADD,CAAD,EAEPM,WAAW,CAACzB,SAFL,EAEgB,WAFhB,EAE6B,KAAK,CAFlC,CAAV;;AAGAE,EAAAA,UAAU,CAAC,CACPiB,QAAQ,CAAC,cAAD,CADD,CAAD,EAEPM,WAAW,CAACzB,SAFL,EAEgB,YAFhB,EAE8B,KAAK,CAFnC,CAAV;;AAGAE,EAAAA,UAAU,CAAC,CACPiB,QAAQ,CAAC,cAAD,CADD,CAAD,EAEPM,WAAW,CAACzB,SAFL,EAEgB,UAFhB,EAE4B,KAAK,CAFjC,CAAV;;AAGAE,EAAAA,UAAU,CAAC,CACPiB,QAAQ,CAAC,cAAD,CADD,CAAD,EAEPM,WAAW,CAACzB,SAFL,EAEgB,YAFhB,EAE8B,KAAK,CAFnC,CAAV;;AAGAE,EAAAA,UAAU,CAAC,CACPiB,QAAQ,EADD,CAAD,EAEPM,WAAW,CAACzB,SAFL,EAEgB,WAFhB,EAE6B,KAAK,CAFlC,CAAV;;AAGA,SAAOyB,WAAP;AACH,CA5BgC,CA4B/BL,UA5B+B,CAAjC;;AA6BA,SAASK,WAAT;;AACA,IAAIO,YAAY,GAAkB,UAAUN,MAAV,EAAkB;AAChDtC,EAAAA,SAAS,CAAC4C,YAAD,EAAeN,MAAf,CAAT;;AACA,WAASM,YAAT,GAAwB;AACpB,QAAIL,KAAK,GAAGD,MAAM,KAAK,IAAX,IAAmBA,MAAM,CAACE,KAAP,CAAa,IAAb,EAAmBpB,SAAnB,CAAnB,IAAoD,IAAhE;;AACAmB,IAAAA,KAAK,CAACM,IAAN,GAAa,EAAb;AACA;AACR;AACA;;AACQN,IAAAA,KAAK,CAACO,OAAN,GAAgB,CAAhB;AACAP,IAAAA,KAAK,CAACQ,WAAN,GAAoB,CAApB;AACA,WAAOR,KAAP;AACH;;AACDzB,EAAAA,UAAU,CAAC,CACPiB,QAAQ,CAAC,cAAD,CADD,CAAD,EAEPa,YAAY,CAAChC,SAFN,EAEiB,MAFjB,EAEyB,KAAK,CAF9B,CAAV;;AAGAE,EAAAA,UAAU,CAAC,CACPiB,QAAQ,CAAC,cAAD,CADD,CAAD,EAEPa,YAAY,CAAChC,SAFN,EAEiB,OAFjB,EAE0B,KAAK,CAF/B,CAAV;;AAGAE,EAAAA,UAAU,CAAC,CACPiB,QAAQ,CAAC,cAAD,CADD,CAAD,EAEPa,YAAY,CAAChC,SAFN,EAEiB,SAFjB,EAE4B,KAAK,CAFjC,CAAV;;AAGAE,EAAAA,UAAU,CAAC,CACPiB,QAAQ,CAAC,QAAD,CADD,CAAD,EAEPa,YAAY,CAAChC,SAFN,EAEiB,aAFjB,EAEgC,KAAK,CAFrC,CAAV;;AAGA,SAAOgC,YAAP;AACH,CAzBiC,CAyBhCZ,UAzBgC,CAAlC;;AA0BA,SAASY,YAAT;;AACA,IAAII,UAAU,GAAkB,UAAUV,MAAV,EAAkB;AAC9CtC,EAAAA,SAAS,CAACgD,UAAD,EAAaV,MAAb,CAAT;;AACA,WAASU,UAAT,GAAsB;AAClB,QAAIT,KAAK,GAAGD,MAAM,CAACW,IAAP,CAAY,IAAZ,KAAqB,IAAjC;;AACAV,IAAAA,KAAK,CAACW,MAAN,GAAe,IAAIN,YAAJ,EAAf;AACAL,IAAAA,KAAK,CAACY,KAAN,GAAc,IAAId,WAAJ,EAAd;AACA;AACR;AACA;AACA;AACA;;AACQE,IAAAA,KAAK,CAACa,QAAN,GAAiB,EAAjB;AACA;AACR;AACA;AACA;AACA;;AACQb,IAAAA,KAAK,CAACc,QAAN,GAAiB,CAAjB;;AACA,QAAIC,cAAc,GAAG,YAAY;AAAE,aAAOf,KAAK,CAACgB,SAAN,CAAgB;AAAEC,QAAAA,IAAI,EAAE;AAAR,OAAhB,CAAP;AAA6C,KAAhF;;AACAjB,IAAAA,KAAK,CAACW,MAAN,CAAaO,gBAAb,CAA8B,QAA9B,EAAwCH,cAAxC;;AACAf,IAAAA,KAAK,CAACY,KAAN,CAAYM,gBAAZ,CAA6B,QAA7B,EAAuCH,cAAvC;;AACA,QAAII,oBAAoB,GAAG,YAAY;AAAE,aAAOnB,KAAK,CAACgB,SAAN,CAAgB;AAAEC,QAAAA,IAAI,EAAE;AAAR,OAAhB,CAAP;AAAmD,KAA5F;;AACAjB,IAAAA,KAAK,CAACW,MAAN,CAAaO,gBAAb,CAA8B,cAA9B,EAA8CC,oBAA9C;;AACAnB,IAAAA,KAAK,CAACY,KAAN,CAAYM,gBAAZ,CAA6B,cAA7B,EAA6CC,oBAA7C;;AACA,WAAOnB,KAAP;AACH;;AACDzB,EAAAA,UAAU,CAAC,CACPiB,QAAQ,CAAC,cAAD,CADD,CAAD,EAEPiB,UAAU,CAACpC,SAFJ,EAEe,UAFf,EAE2B,KAAK,CAFhC,CAAV;;AAGAE,EAAAA,UAAU,CAAC,CACPiB,QAAQ,CAAC,cAAD,CADD,CAAD,EAEPiB,UAAU,CAACpC,SAFJ,EAEe,UAFf,EAE2B,KAAK,CAFhC,CAAV;;AAGA,SAAOoC,UAAP;AACH,CAjC+B,CAiC9BhB,UAjC8B,CAAhC;;AAkCA,SAASgB,UAAT;;AACA,IAAIW,MAAM,GAAkB,UAAUrB,MAAV,EAAkB;AAC1CtC,EAAAA,SAAS,CAAC2D,MAAD,EAASrB,MAAT,CAAT;;AACA,WAASqB,MAAT,GAAkB;AACd,QAAIpB,KAAK,GAAGD,MAAM,CAACW,IAAP,CAAY,IAAZ,KAAqB,IAAjC;;AACAV,IAAAA,KAAK,CAACqB,EAAN,GAAW1B,QAAQ,CAACK,KAAD,CAAnB;AACAA,IAAAA,KAAK,CAACsB,KAAN,GAAc,IAAIjC,KAAJ,EAAd;AACAW,IAAAA,KAAK,CAACuB,aAAN,GAAsBjC,SAAS,CAACkC,MAAV,CAAiBxB,KAAK,CAACsB,KAAvB,EAA8BG,SAA9B,EAAtB;AACAzB,IAAAA,KAAK,CAAC0B,OAAN,GAAgB,CAAC,CAAD,EAAI,CAAJ,CAAhB;AACA1B,IAAAA,KAAK,CAAC2B,IAAN,GAAa,IAAIlB,UAAJ,EAAb;AACAT,IAAAA,KAAK,CAAC4B,IAAN,GAAa,EAAb;AACA5B,IAAAA,KAAK,CAAC6B,OAAN,GAAgB,IAAhB;AACA7B,IAAAA,KAAK,CAAC8B,WAAN,GAAoBlC,iBAAiB,CAACmC,QAAtC;AACA/B,IAAAA,KAAK,CAACgC,QAAN,GAAiBnC,cAAc,CAACoC,KAAhC;AACA;AACR;AACA;;AACQjC,IAAAA,KAAK,CAACkC,OAAN,GAAgB,EAAhB;AACAlC,IAAAA,KAAK,CAACmC,KAAN,GAAc,CAAC,CAAD,EAAI,CAAJ,CAAd;;AACAnC,IAAAA,KAAK,CAACoC,mBAAN,CAA0B,MAA1B,EAAkCpC,KAAK,CAACqC,YAAxC;;AACArC,IAAAA,KAAK,CAACoC,mBAAN,CAA0B,SAA1B,EAAqCpC,KAAK,CAACsC,eAA3C;;AACAtC,IAAAA,KAAK,CAACoC,mBAAN,CAA0B,UAA1B,EAAsCpC,KAAK,CAACuC,gBAA5C;;AACAvC,IAAAA,KAAK,CAAC2B,IAAN,CAAWhB,MAAX,CAAkByB,mBAAlB,CAAsC,OAAtC,EAA+CpC,KAAK,CAACwC,mBAArD,EAA0ExC,KAA1E;;AACAA,IAAAA,KAAK,CAACkB,gBAAN,CAAuB,QAAvB,EAAiClB,KAAK,CAACyC,MAAvC;;AACAzC,IAAAA,KAAK,CAAC2B,IAAN,CAAWT,gBAAX,CAA4B,QAA5B,EAAsC,YAAY;AAAE,aAAOlB,KAAK,CAACgB,SAAN,CAAgB;AAAEC,QAAAA,IAAI,EAAE;AAAR,OAAhB,CAAP;AAA6C,KAAjG;;AACAjB,IAAAA,KAAK,CAAC2B,IAAN,CAAWT,gBAAX,CAA4B,cAA5B,EAA4C,YAAY;AAAE,aAAOlB,KAAK,CAACgB,SAAN,CAAgB;AAAEC,QAAAA,IAAI,EAAE;AAAR,OAAhB,CAAP;AAAmD,KAA7G;;AACA,WAAOjB,KAAP;AACH;;AACDnC,EAAAA,MAAM,CAACuB,cAAP,CAAsBgC,MAAM,CAAC/C,SAA7B,EAAwC,MAAxC,EAAgD;AAC5CqE,IAAAA,GAAG,EAAE,YAAY;AACb,aAAO,KAAKP,KAAZ;AACH,KAH2C;AAI5CQ,IAAAA,UAAU,EAAE,IAJgC;AAK5CC,IAAAA,YAAY,EAAE;AAL8B,GAAhD;;AAOAxB,EAAAA,MAAM,CAAC/C,SAAP,CAAiBgE,YAAjB,GAAgC,UAAUQ,KAAV,EAAiB;AAC7C,SAAKvB,KAAL,CAAWwB,OAAX,GAAqBD,KAAK,CAACE,KAAN,CAAYjE,MAAZ,GAAqB,CAArB,IAA0B,KAAK+C,OAApD;AACH,GAFD;;AAGAT,EAAAA,MAAM,CAAC/C,SAAP,CAAiBiE,eAAjB,GAAmC,UAAUO,KAAV,EAAiB;AAChD,SAAKvB,KAAL,CAAWwB,OAAX,GAAqBD,KAAK,CAACE,KAAN,IAAe,KAAKnB,IAAL,CAAU9C,MAAV,GAAmB,CAAvD;AACH,GAFD;;AAGAsC,EAAAA,MAAM,CAAC/C,SAAP,CAAiBkE,gBAAjB,GAAoC,UAAUM,KAAV,EAAiB;AACjD,YAAQA,KAAK,CAACE,KAAd;AACI,WAAK,OAAL;AACA,WAAK,MAAL;AACI,aAAKjB,WAAL,GAAmBlC,iBAAiB,CAACmC,QAArC;AACA;;AACJ,WAAK,QAAL;AACA,WAAK,KAAL;AACI,aAAKD,WAAL,GAAmBlC,iBAAiB,CAACoD,UAArC;AACA;AARR;AAUH,GAXD;;AAYA5B,EAAAA,MAAM,CAAC/C,SAAP,CAAiBmE,mBAAjB,GAAuC,YAAY;AAC/C,SAAKjB,aAAL,GAAqB,KAAKA,aAAL,CAAmB0B,OAAnB,CAA2B,EAA3B,CAArB;AACA,SAAK1B,aAAL,CAAmB2B,IAAnB,CAAwBC,MAAxB;;AACA,QAAI,KAAK7B,KAAL,CAAW8B,KAAf,EAAsB;AAClB,WAAK9B,KAAL,CAAW8B,KAAX,CAAiBC,YAAjB;AACH;AACJ,GAND;AAOA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACIjC,EAAAA,MAAM,CAAC/C,SAAP,CAAiBiF,aAAjB,GAAiC,UAAUC,KAAV,EAAiBC,MAAjB,EAAyB;AACtD,QAAI7B,IAAI,GAAG,KAAKA,IAAhB;AACA,QAAIhB,MAAM,GAAGgB,IAAI,CAAChB,MAAlB;AAAA,QAA0BE,QAAQ,GAAGc,IAAI,CAACd,QAA1C;AAAA,QAAoDC,QAAQ,GAAGa,IAAI,CAACb,QAApE;AACA,QAAI2C,eAAe,GAAG,KAAKlC,aAAL,CAAmB0B,OAAnB,CAA2B,KAAKrB,IAAhC,EAAsC,UAAU8B,CAAV,EAAaC,KAAb,EAAoB;AAC5E,UAAIC,WAAW,GAAGlE,SAAS,CAACiB,MAAM,CAACkD,KAAP,IAAgBF,KAAK,CAAChD,MAAN,CAAakD,KAA9B,CAA3B;AACA,aAAOF,KAAK,CAACtC,EAAN,GAAW,GAAX,GAAiBsC,KAAK,CAACG,MAAvB,GAAgC,GAAhC,GAAsCF,WAAW,CAACG,IAAzD;AACH,KAHqB,CAAtB;AAIAN,IAAAA,eAAe,CAACP,IAAhB,CAAqBC,MAArB;AACA,QAAIa,cAAc,GAAGP,eAAe,CAACQ,KAAhB,CAAsBC,MAAtB,CAA6B3E,WAA7B,EAA0C4E,IAA1C,CAA+C,UAAUC,IAAV,EAAgBT,KAAhB,EAAuB;AACvF,UAAIC,WAAW,GAAGlE,SAAS,CAACiB,MAAM,CAACkD,KAAP,IAAgBF,KAAK,CAAChD,MAAN,CAAakD,KAA9B,CAA3B;AACAO,MAAAA,IAAI,CAACzD,MAAL,GAAc,IAAIiD,WAAJ,EAAd;AACH,KAHoB,CAArB;AAIA,QAAIrC,aAAa,GAAG,KAAKA,aAAL,GAAqBkC,eAAe,CAACY,KAAhB,CAAsBL,cAAtB,CAAzC;AACA,QAAIM,SAAS,GAAG/C,aAAa,CAACjB,IAA9B,CAbsD,CActD;;AACA,QAAIiE,MAAM,GAAG,EAAb;AACA,QAAIC,UAAU,GAAG,KAAK7C,IAAL,CAAUhB,MAA3B;AACA,QAAI8D,SAAS,GAAG,KAAK9C,IAAL,CAAUf,KAA1B;AACAW,IAAAA,aAAa,CAAC4C,IAAd,CAAmB,UAAUO,WAAV,EAAuBf,KAAvB,EAA8B;AAC7C;AACAe,MAAAA,WAAW,CAACC,UAAZ,GAAyBH,UAAU,CAAClE,IAApC;AACAoE,MAAAA,WAAW,CAACxC,OAAZ,GAAsBsC,UAAU,CAACjE,OAAjC;AACAmE,MAAAA,WAAW,CAACE,SAAZ,GAAwBH,SAAS,CAACG,SAAlC;AACAF,MAAAA,WAAW,CAACG,UAAZ,GAAyBJ,SAAS,CAACI,UAAnC;AACAH,MAAAA,WAAW,CAACvE,QAAZ,GAAuBsE,SAAS,CAACtE,QAAjC;AACAuE,MAAAA,WAAW,CAACtE,UAAZ,GAAyBqE,SAAS,CAACrE,UAAnC;AACAsE,MAAAA,WAAW,CAACI,IAAZ,GAAmBnB,KAAK,CAAC/C,KAAN,CAAYkE,IAA/B;AACAP,MAAAA,MAAM,CAACQ,IAAP,CAAYL,WAAW,CAACM,WAAZ,EAAZ;AACH,KAVD;AAWA,QAAIC,UAAU,GAAGV,MAAM,CAACzF,MAAP,IAAiByF,MAAM,CAAC,CAAD,CAAN,CAAUf,MAA5C;AACA,QAAI0B,QAAQ,GAAG,CAAf;AACA,QAAIC,WAAW,GAAG,CAAlB;AACA,QAAIC,gBAAgB,GAAG,CAAvB;AACA,QAAIC,iBAAiB,GAAG,CAAxB;;AACA,YAAQ,KAAKvD,WAAb;AACI,WAAKlC,iBAAiB,CAACoD,UAAvB;AACI,YAAI,EAAEsC,QAAQ,CAAC/B,KAAD,CAAR,IAAmBA,KAAK,GAAG,CAA7B,CAAJ,EAAqC;AACjC,iBAAO,KAAP;AACH;;AACD2B,QAAAA,QAAQ,GAAG,CAAX;AACA,YAAIK,WAAW,GAAG,CAAlB,CALJ,CAMI;;AACA,WAAG;AACC,cAAIC,UAAU,GAAG,CAAjB;AACAD,UAAAA,WAAW,GAAG,CAAd;AACAJ,UAAAA,WAAW,GAAG,CAAd;AACAD,UAAAA,QAAQ;AACR,cAAI/F,CAAC,GAAG,CAAR;;AACA,iBAAOA,CAAC,GAAGmF,SAAX,EAAsB;AAClB,gBAAImB,IAAI,GAAGlB,MAAM,CAACpF,CAAD,CAAjB;;AACA,gBAAIsG,IAAI,CAAClC,KAAL,GAAa4B,WAAjB,EAA8B;AAC1BA,cAAAA,WAAW,GAAGM,IAAI,CAAClC,KAAnB;AACH;;AACDpE,YAAAA,CAAC;;AACD,gBAAIA,CAAC,GAAG+F,QAAJ,KAAiB,CAArB,EAAwB;AACpBM,cAAAA,UAAU,IAAIL,WAAd;AACAA,cAAAA,WAAW,GAAG,CAAd;AACAI,cAAAA,WAAW;AACd;AACJ;;AACD,cAAIpG,CAAC,GAAG+F,QAAJ,KAAiB,CAArB,EAAwB;AACpBM,YAAAA,UAAU,IAAIL,WAAd;AACAI,YAAAA,WAAW;AACd;;AACDH,UAAAA,gBAAgB,GAAGI,UAAU,GAAG,CAACD,WAAW,GAAG,CAAf,IAAoB1E,QAApD;AACH,SAvBD,QAuBSuE,gBAAgB,GAAG7B,KAAnB,IAA4BgC,WAAW,GAAG,CAvBnD;;AAwBAF,QAAAA,iBAAiB,GAAGJ,UAAU,GAAGC,QAAb,GAAwB,CAACA,QAAQ,GAAG,CAAZ,IAAiBpE,QAA7D;AACA;;AACJ,WAAKlB,iBAAiB,CAACmC,QAAvB;AACI,YAAI,EAAEuD,QAAQ,CAAC9B,MAAD,CAAR,IAAoBA,MAAM,GAAG,CAA/B,CAAJ,EAAuC;AACnC,iBAAO,KAAP;AACH;;AACD0B,QAAAA,QAAQ,GAAGZ,SAAS,GAAG,CAAvB,CAJJ,CAKI;;AACA,WAAG;AACCY,UAAAA,QAAQ,GAAG,CAACA,QAAQ,IAAI,CAAb,IAAmBA,QAAQ,GAAG,CAAzC;AACAC,UAAAA,WAAW,GAAG,CAAd;AACA,cAAIK,UAAU,GAAG,CAAjB;AACA,cAAIE,WAAW,GAAG,CAAlB;AACA,cAAIC,aAAa,GAAG,CAApB;AACA,cAAIxG,CAAC,GAAG,CAAR;;AACA,iBAAOA,CAAC,GAAGmF,SAAX,EAAsB;AAClB,gBAAImB,IAAI,GAAGlB,MAAM,CAACpF,CAAD,CAAjB;;AACA,gBAAI,CAACwG,aAAL,EAAoB;AAChBD,cAAAA,WAAW,IAAID,IAAI,CAACjC,MAApB;AACH;;AACD,gBAAIiC,IAAI,CAAClC,KAAL,GAAa4B,WAAjB,EAA8B;AAC1BA,cAAAA,WAAW,GAAGM,IAAI,CAAClC,KAAnB;AACH;;AACDpE,YAAAA,CAAC;;AACD,gBAAIA,CAAC,GAAG+F,QAAJ,KAAiB,CAArB,EAAwB;AACpBM,cAAAA,UAAU,IAAIL,WAAd;AACAA,cAAAA,WAAW,GAAG,CAAd;AACAQ,cAAAA,aAAa;AAChB;AACJ;;AACD,cAAIxG,CAAC,GAAG+F,QAAJ,KAAiB,CAArB,EAAwB;AACpBM,YAAAA,UAAU,IAAIL,WAAd;AACAQ,YAAAA,aAAa;AAChB;;AACDP,UAAAA,gBAAgB,GAAGI,UAAU,GAAG,CAACG,aAAa,GAAG,CAAjB,IAAsB9E,QAAtD;AACAwE,UAAAA,iBAAiB,GAAGK,WAAW,GAAG,CAACR,QAAQ,GAAG,CAAZ,IAAiBpE,QAAnD;AACH,SA5BD,QA4BSuE,iBAAiB,GAAG7B,MAApB,IAA8B0B,QAAQ,GAAG,CA5BlD;;AA6BA;AArER,KAlCsD,CAyGtD;;;AACA,QAAIU,MAAM,GAAG,CAACrC,KAAK,GAAG6B,gBAAT,IAA6B,CAA1C;AACA,QAAIS,MAAM,GAAG,CAACrC,MAAM,GAAG6B,iBAAV,IAA+B,CAA5C;AACA,QAAIS,CAAC,GAAG,CAAR;AACA,QAAIC,CAAC,GAAG,CAAR;AACAZ,IAAAA,WAAW,GAAG,CAAd,CA9GsD,CA+GtD;;AACA5D,IAAAA,aAAa,CAAC4C,IAAd,CAAmB,UAAUO,WAAV,EAAuBf,KAAvB,EAA8BxE,CAA9B,EAAiC;AAChD;AACAuF,MAAAA,WAAW,CAACsB,YAAZ,GAA2BC,IAAI,CAACC,KAAL,CAAWN,MAAM,GAAGE,CAApB,CAA3B;AACApB,MAAAA,WAAW,CAACyB,YAAZ,GAA2BF,IAAI,CAACC,KAAL,CAAWL,MAAM,GAAGE,CAApB,CAA3B;AACA,UAAIN,IAAI,GAAGlB,MAAM,CAACpF,CAAD,CAAjB;;AACA,UAAIsG,IAAI,CAAClC,KAAL,GAAa4B,WAAjB,EAA8B;AAC1BA,QAAAA,WAAW,GAAGM,IAAI,CAAClC,KAAnB;AACH;;AACD,UAAI,CAACpE,CAAC,GAAG,CAAL,IAAU+F,QAAV,KAAuB,CAA3B,EAA8B;AAC1BY,QAAAA,CAAC,IAAIX,WAAW,GAAGtE,QAAnB;AACAkF,QAAAA,CAAC,GAAG,CAAJ;AACAZ,QAAAA,WAAW,GAAG,CAAd;AACH,OAJD,MAKK;AACDY,QAAAA,CAAC,IAAIN,IAAI,CAACjC,MAAL,GAAc1C,QAAnB;AACH;AACJ,KAhBD,EAhHsD,CAiItD;;AACA,SAAK2B,MAAL;AACA,QAAInC,IAAI,GAAG,KAAK6B,KAAhB;AACA,QAAIT,OAAO,GAAG,KAAKA,OAAnB;AACApB,IAAAA,IAAI,CAAC,CAAD,CAAJ,GAAU8E,gBAAV;AACA9E,IAAAA,IAAI,CAAC,CAAD,CAAJ,GAAU+E,iBAAV;;AACA,QAAI/E,IAAI,CAAC,CAAD,CAAJ,KAAYoB,OAAO,CAAC,CAAD,CAAnB,IAA0BpB,IAAI,CAAC,CAAD,CAAJ,KAAYoB,OAAO,CAAC,CAAD,CAAjD,EAAsD;AAClDA,MAAAA,OAAO,CAAC,CAAD,CAAP,GAAapB,IAAI,CAAC,CAAD,CAAjB;AACAoB,MAAAA,OAAO,CAAC,CAAD,CAAP,GAAapB,IAAI,CAAC,CAAD,CAAjB;AACH;AACJ,GA3ID;;AA4IAc,EAAAA,MAAM,CAAC/C,SAAP,CAAiBoE,MAAjB,GAA0B,YAAY;AAClC,QAAIzC,KAAK,GAAG,IAAZ;;AACA,SAAKuB,aAAL,CAAmB4C,IAAnB,CAAwB,UAAUO,WAAV,EAAuBf,KAAvB,EAA8B;AAClD,UAAIhD,MAAM,GAAGgD,KAAK,CAAChD,MAAnB;AACA+D,MAAAA,WAAW,CAAC0B,UAAZ,GAAyBzF,MAAM,CAAC0F,IAAhC;AACA3B,MAAAA,WAAW,CAAC4B,YAAZ,GAA2B3F,MAAM,CAAC4F,MAAlC;AACA7B,MAAAA,WAAW,CAAC8B,iBAAZ,GAAgCxG,KAAK,CAAC2B,IAAN,CAAWhB,MAAX,CAAkBH,WAAlD;AACAkE,MAAAA,WAAW,CAAC+B,iBAAZ,GAAgC9F,MAAM,CAAC+F,WAAvC;AACAhC,MAAAA,WAAW,CAACiC,mBAAZ,GAAkChG,MAAM,CAACiG,aAAzC;AACAlC,MAAAA,WAAW,CAACmC,OAAZ,GAAsBlD,KAAK,CAAC9B,OAAN,GAAgB,CAAhB,GAAoB,GAA1C;AACA6C,MAAAA,WAAW,CAACxE,KAAZ,GAAoBF,KAAK,CAAC2B,IAAN,CAAWf,KAAX,CAAiBV,KAArC;AACH,KATD;AAUH,GAZD;;AAaAkB,EAAAA,MAAM,CAAC/C,SAAP,CAAiByI,gBAAjB,GAAoC,UAAUhB,CAAV,EAAaC,CAAb,EAAgB;AAChD,QAAI3B,IAAI,GAAG,KAAK9C,KAAL,CAAWyF,QAAX,CAAoBjB,CAApB,EAAuBC,CAAvB,CAAX;;AACA,QAAI3B,IAAI,IAAIA,IAAI,CAAC4C,MAAjB,EAAyB;AACrB,aAAO5C,IAAI,CAAC4C,MAAL,CAAYrD,KAAnB;AACH;AACJ,GALD;;AAMAvC,EAAAA,MAAM,CAAC6F,SAAP,GAAmB,QAAnB;;AACA1I,EAAAA,UAAU,CAAC,CACPiB,QAAQ,CAAC,cAAD,CADD,CAAD,EAEP4B,MAAM,CAAC/C,SAFA,EAEW,MAFX,EAEmB,KAAK,CAFxB,CAAV;;AAGAE,EAAAA,UAAU,CAAC,CACPiB,QAAQ,CAAC,cAAD,CADD,CAAD,EAEP4B,MAAM,CAAC/C,SAFA,EAEW,SAFX,EAEsB,KAAK,CAF3B,CAAV;;AAGAE,EAAAA,UAAU,CAAC,CACPiB,QAAQ,CAAC,cAAD,CADD,CAAD,EAEP4B,MAAM,CAAC/C,SAFA,EAEW,aAFX,EAE0B,KAAK,CAF/B,CAAV;;AAGAE,EAAAA,UAAU,CAAC,CACPiB,QAAQ,CAAC,cAAD,CADD,CAAD,EAEP4B,MAAM,CAAC/C,SAFA,EAEW,UAFX,EAEuB,KAAK,CAF5B,CAAV;;AAGAE,EAAAA,UAAU,CAAC,CACPiB,QAAQ,CAAC,cAAD,CADD,CAAD,EAEP4B,MAAM,CAAC/C,SAFA,EAEW,SAFX,EAEsB,KAAK,CAF3B,CAAV;;AAGA,SAAO+C,MAAP;AACH,CAvP2B,CAuP1B3B,UAvP0B,CAA5B;;AAwPA,SAAS2B,MAAT","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nimport { Group } from \"../scene/group\";\nimport { Selection } from \"../scene/selection\";\nimport { MarkerLabel } from \"./markerLabel\";\nimport { reactive, Observable } from \"../util/observable\";\nimport { getMarker } from \"./marker/util\";\nimport { createId } from \"../util/id\";\nexport var LegendOrientation;\n(function (LegendOrientation) {\n    LegendOrientation[LegendOrientation[\"Vertical\"] = 0] = \"Vertical\";\n    LegendOrientation[LegendOrientation[\"Horizontal\"] = 1] = \"Horizontal\";\n})(LegendOrientation || (LegendOrientation = {}));\nexport var LegendPosition;\n(function (LegendPosition) {\n    LegendPosition[\"Top\"] = \"top\";\n    LegendPosition[\"Right\"] = \"right\";\n    LegendPosition[\"Bottom\"] = \"bottom\";\n    LegendPosition[\"Left\"] = \"left\";\n})(LegendPosition || (LegendPosition = {}));\nvar LegendLabel = /** @class */ (function (_super) {\n    __extends(LegendLabel, _super);\n    function LegendLabel() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.color = 'black';\n        _this.fontSize = 12;\n        _this.fontFamily = 'Verdana, sans-serif';\n        return _this;\n    }\n    __decorate([\n        reactive('change')\n    ], LegendLabel.prototype, \"color\", void 0);\n    __decorate([\n        reactive('layoutChange')\n    ], LegendLabel.prototype, \"fontStyle\", void 0);\n    __decorate([\n        reactive('layoutChange')\n    ], LegendLabel.prototype, \"fontWeight\", void 0);\n    __decorate([\n        reactive('layoutChange')\n    ], LegendLabel.prototype, \"fontSize\", void 0);\n    __decorate([\n        reactive('layoutChange')\n    ], LegendLabel.prototype, \"fontFamily\", void 0);\n    __decorate([\n        reactive()\n    ], LegendLabel.prototype, \"formatter\", void 0);\n    return LegendLabel;\n}(Observable));\nexport { LegendLabel };\nvar LegendMarker = /** @class */ (function (_super) {\n    __extends(LegendMarker, _super);\n    function LegendMarker() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.size = 15;\n        /**\n         * Padding between the marker and the label within each legend item.\n         */\n        _this.padding = 8;\n        _this.strokeWidth = 1;\n        return _this;\n    }\n    __decorate([\n        reactive('layoutChange')\n    ], LegendMarker.prototype, \"size\", void 0);\n    __decorate([\n        reactive('layoutChange')\n    ], LegendMarker.prototype, \"shape\", void 0);\n    __decorate([\n        reactive('layoutChange')\n    ], LegendMarker.prototype, \"padding\", void 0);\n    __decorate([\n        reactive('change')\n    ], LegendMarker.prototype, \"strokeWidth\", void 0);\n    return LegendMarker;\n}(Observable));\nexport { LegendMarker };\nvar LegendItem = /** @class */ (function (_super) {\n    __extends(LegendItem, _super);\n    function LegendItem() {\n        var _this = _super.call(this) || this;\n        _this.marker = new LegendMarker();\n        _this.label = new LegendLabel();\n        /**\n         * The legend uses grid layout for its items, occupying as few columns as possible when positioned to left or right,\n         * and as few rows as possible when positioned to top or bottom. This config specifies the amount of horizontal\n         * padding between legend items.\n         */\n        _this.paddingX = 16;\n        /**\n         * The legend uses grid layout for its items, occupying as few columns as possible when positioned to left or right,\n         * and as few rows as possible when positioned to top or bottom. This config specifies the amount of vertical\n         * padding between legend items.\n         */\n        _this.paddingY = 8;\n        var changeListener = function () { return _this.fireEvent({ type: 'change' }); };\n        _this.marker.addEventListener('change', changeListener);\n        _this.label.addEventListener('change', changeListener);\n        var layoutChangeListener = function () { return _this.fireEvent({ type: 'layoutChange' }); };\n        _this.marker.addEventListener('layoutChange', layoutChangeListener);\n        _this.label.addEventListener('layoutChange', layoutChangeListener);\n        return _this;\n    }\n    __decorate([\n        reactive('layoutChange')\n    ], LegendItem.prototype, \"paddingX\", void 0);\n    __decorate([\n        reactive('layoutChange')\n    ], LegendItem.prototype, \"paddingY\", void 0);\n    return LegendItem;\n}(Observable));\nexport { LegendItem };\nvar Legend = /** @class */ (function (_super) {\n    __extends(Legend, _super);\n    function Legend() {\n        var _this = _super.call(this) || this;\n        _this.id = createId(_this);\n        _this.group = new Group();\n        _this.itemSelection = Selection.select(_this.group).selectAll();\n        _this.oldSize = [0, 0];\n        _this.item = new LegendItem();\n        _this.data = [];\n        _this.enabled = true;\n        _this.orientation = LegendOrientation.Vertical;\n        _this.position = LegendPosition.Right;\n        /**\n         * Spacing between the legend and the edge of the chart's element.\n         */\n        _this.spacing = 20;\n        _this._size = [0, 0];\n        _this.addPropertyListener('data', _this.onDataChange);\n        _this.addPropertyListener('enabled', _this.onEnabledChange);\n        _this.addPropertyListener('position', _this.onPositionChange);\n        _this.item.marker.addPropertyListener('shape', _this.onMarkerShapeChange, _this);\n        _this.addEventListener('change', _this.update);\n        _this.item.addEventListener('change', function () { return _this.fireEvent({ type: 'change' }); });\n        _this.item.addEventListener('layoutChange', function () { return _this.fireEvent({ type: 'layoutChange' }); });\n        return _this;\n    }\n    Object.defineProperty(Legend.prototype, \"size\", {\n        get: function () {\n            return this._size;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Legend.prototype.onDataChange = function (event) {\n        this.group.visible = event.value.length > 0 && this.enabled;\n    };\n    Legend.prototype.onEnabledChange = function (event) {\n        this.group.visible = event.value && this.data.length > 0;\n    };\n    Legend.prototype.onPositionChange = function (event) {\n        switch (event.value) {\n            case 'right':\n            case 'left':\n                this.orientation = LegendOrientation.Vertical;\n                break;\n            case 'bottom':\n            case 'top':\n                this.orientation = LegendOrientation.Horizontal;\n                break;\n        }\n    };\n    Legend.prototype.onMarkerShapeChange = function () {\n        this.itemSelection = this.itemSelection.setData([]);\n        this.itemSelection.exit.remove();\n        if (this.group.scene) {\n            this.group.scene.cancelRender();\n        }\n    };\n    /**\n     * The method is given the desired size of the legend, which only serves as a hint.\n     * The vertically oriented legend will take as much horizontal space as needed, but will\n     * respect the height constraints, and the horizontal legend will take as much vertical\n     * space as needed in an attempt not to exceed the given width.\n     * After the layout is done, the {@link size} will contain the actual size of the legend.\n     * If the actual size is not the same as the previous actual size, the legend will fire\n     * the 'layoutChange' event to communicate that another layout is needed, and the above\n     * process should be repeated.\n     * @param width\n     * @param height\n     */\n    Legend.prototype.performLayout = function (width, height) {\n        var item = this.item;\n        var marker = item.marker, paddingX = item.paddingX, paddingY = item.paddingY;\n        var updateSelection = this.itemSelection.setData(this.data, function (_, datum) {\n            var MarkerShape = getMarker(marker.shape || datum.marker.shape);\n            return datum.id + '-' + datum.itemId + '-' + MarkerShape.name;\n        });\n        updateSelection.exit.remove();\n        var enterSelection = updateSelection.enter.append(MarkerLabel).each(function (node, datum) {\n            var MarkerShape = getMarker(marker.shape || datum.marker.shape);\n            node.marker = new MarkerShape();\n        });\n        var itemSelection = this.itemSelection = updateSelection.merge(enterSelection);\n        var itemCount = itemSelection.size;\n        // Update properties that affect the size of the legend items and measure them.\n        var bboxes = [];\n        var itemMarker = this.item.marker;\n        var itemLabel = this.item.label;\n        itemSelection.each(function (markerLabel, datum) {\n            // TODO: measure only when one of these properties or data change (in a separate routine)\n            markerLabel.markerSize = itemMarker.size;\n            markerLabel.spacing = itemMarker.padding;\n            markerLabel.fontStyle = itemLabel.fontStyle;\n            markerLabel.fontWeight = itemLabel.fontWeight;\n            markerLabel.fontSize = itemLabel.fontSize;\n            markerLabel.fontFamily = itemLabel.fontFamily;\n            markerLabel.text = datum.label.text;\n            bboxes.push(markerLabel.computeBBox());\n        });\n        var itemHeight = bboxes.length && bboxes[0].height;\n        var rowCount = 0;\n        var columnWidth = 0;\n        var paddedItemsWidth = 0;\n        var paddedItemsHeight = 0;\n        switch (this.orientation) {\n            case LegendOrientation.Horizontal:\n                if (!(isFinite(width) && width > 0)) {\n                    return false;\n                }\n                rowCount = 0;\n                var columnCount = 0;\n                // Split legend items into columns until the width is suitable.\n                do {\n                    var itemsWidth = 0;\n                    columnCount = 0;\n                    columnWidth = 0;\n                    rowCount++;\n                    var i = 0;\n                    while (i < itemCount) {\n                        var bbox = bboxes[i];\n                        if (bbox.width > columnWidth) {\n                            columnWidth = bbox.width;\n                        }\n                        i++;\n                        if (i % rowCount === 0) {\n                            itemsWidth += columnWidth;\n                            columnWidth = 0;\n                            columnCount++;\n                        }\n                    }\n                    if (i % rowCount !== 0) {\n                        itemsWidth += columnWidth;\n                        columnCount++;\n                    }\n                    paddedItemsWidth = itemsWidth + (columnCount - 1) * paddingX;\n                } while (paddedItemsWidth > width && columnCount > 1);\n                paddedItemsHeight = itemHeight * rowCount + (rowCount - 1) * paddingY;\n                break;\n            case LegendOrientation.Vertical:\n                if (!(isFinite(height) && height > 0)) {\n                    return false;\n                }\n                rowCount = itemCount * 2;\n                // Split legend items into columns until the height is suitable.\n                do {\n                    rowCount = (rowCount >> 1) + (rowCount % 2);\n                    columnWidth = 0;\n                    var itemsWidth = 0;\n                    var itemsHeight = 0;\n                    var columnCount_1 = 0;\n                    var i = 0;\n                    while (i < itemCount) {\n                        var bbox = bboxes[i];\n                        if (!columnCount_1) {\n                            itemsHeight += bbox.height;\n                        }\n                        if (bbox.width > columnWidth) {\n                            columnWidth = bbox.width;\n                        }\n                        i++;\n                        if (i % rowCount === 0) {\n                            itemsWidth += columnWidth;\n                            columnWidth = 0;\n                            columnCount_1++;\n                        }\n                    }\n                    if (i % rowCount !== 0) {\n                        itemsWidth += columnWidth;\n                        columnCount_1++;\n                    }\n                    paddedItemsWidth = itemsWidth + (columnCount_1 - 1) * paddingX;\n                    paddedItemsHeight = itemsHeight + (rowCount - 1) * paddingY;\n                } while (paddedItemsHeight > height && rowCount > 1);\n                break;\n        }\n        // Top-left corner of the first legend item.\n        var startX = (width - paddedItemsWidth) / 2;\n        var startY = (height - paddedItemsHeight) / 2;\n        var x = 0;\n        var y = 0;\n        columnWidth = 0;\n        // Position legend items using the layout computed above.\n        itemSelection.each(function (markerLabel, datum, i) {\n            // Round off for pixel grid alignment to work properly.\n            markerLabel.translationX = Math.floor(startX + x);\n            markerLabel.translationY = Math.floor(startY + y);\n            var bbox = bboxes[i];\n            if (bbox.width > columnWidth) {\n                columnWidth = bbox.width;\n            }\n            if ((i + 1) % rowCount === 0) {\n                x += columnWidth + paddingX;\n                y = 0;\n                columnWidth = 0;\n            }\n            else {\n                y += bbox.height + paddingY;\n            }\n        });\n        // Update legend item properties that don't affect the layout.\n        this.update();\n        var size = this._size;\n        var oldSize = this.oldSize;\n        size[0] = paddedItemsWidth;\n        size[1] = paddedItemsHeight;\n        if (size[0] !== oldSize[0] || size[1] !== oldSize[1]) {\n            oldSize[0] = size[0];\n            oldSize[1] = size[1];\n        }\n    };\n    Legend.prototype.update = function () {\n        var _this = this;\n        this.itemSelection.each(function (markerLabel, datum) {\n            var marker = datum.marker;\n            markerLabel.markerFill = marker.fill;\n            markerLabel.markerStroke = marker.stroke;\n            markerLabel.markerStrokeWidth = _this.item.marker.strokeWidth;\n            markerLabel.markerFillOpacity = marker.fillOpacity;\n            markerLabel.markerStrokeOpacity = marker.strokeOpacity;\n            markerLabel.opacity = datum.enabled ? 1 : 0.5;\n            markerLabel.color = _this.item.label.color;\n        });\n    };\n    Legend.prototype.getDatumForPoint = function (x, y) {\n        var node = this.group.pickNode(x, y);\n        if (node && node.parent) {\n            return node.parent.datum;\n        }\n    };\n    Legend.className = 'Legend';\n    __decorate([\n        reactive('layoutChange')\n    ], Legend.prototype, \"data\", void 0);\n    __decorate([\n        reactive('layoutChange')\n    ], Legend.prototype, \"enabled\", void 0);\n    __decorate([\n        reactive('layoutChange')\n    ], Legend.prototype, \"orientation\", void 0);\n    __decorate([\n        reactive('layoutChange')\n    ], Legend.prototype, \"position\", void 0);\n    __decorate([\n        reactive('layoutChange')\n    ], Legend.prototype, \"spacing\", void 0);\n    return Legend;\n}(Observable));\nexport { Legend };\n"]},"metadata":{},"sourceType":"module"}