{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nimport { AgChart } from \"ag-charts-community\";\nimport { PolarChartProxy } from \"./polarChartProxy\";\n\nvar PieChartProxy = function (_super) {\n  __extends(PieChartProxy, _super);\n\n  function PieChartProxy(params) {\n    var _this = _super.call(this, params) || this;\n\n    _this.initChartOptions();\n\n    _this.recreateChart();\n\n    return _this;\n  }\n\n  PieChartProxy.prototype.createChart = function () {\n    var options = this.iChartOptions;\n    var seriesDefaults = options.seriesDefaults;\n    var agChartOptions = options;\n    agChartOptions.autoSize = true;\n    agChartOptions.series = [__assign(__assign({}, seriesDefaults), {\n      fills: seriesDefaults.fill.colors,\n      fillOpacity: seriesDefaults.fill.opacity,\n      strokes: seriesDefaults.stroke.colors,\n      strokeOpacity: seriesDefaults.stroke.opacity,\n      strokeWidth: seriesDefaults.stroke.width,\n      type: 'pie'\n    })];\n    return AgChart.create(agChartOptions, this.chartProxyParams.parentElement);\n  };\n\n  PieChartProxy.prototype.update = function (params) {\n    var chart = this.chart;\n\n    if (params.fields.length === 0) {\n      chart.removeAllSeries();\n      return;\n    }\n\n    var field = params.fields[0];\n    var angleField = field;\n\n    if (this.crossFiltering) {\n      // add additional filtered out field\n      var fields_1 = params.fields;\n      fields_1.forEach(function (field) {\n        var crossFilteringField = __assign({}, field);\n\n        crossFilteringField.colId = field.colId + '-filtered-out';\n        fields_1.push(crossFilteringField);\n      });\n      var filteredOutField_1 = fields_1[1];\n      params.data.forEach(function (d) {\n        d[field.colId + '-total'] = d[field.colId] + d[filteredOutField_1.colId];\n        d[field.colId] = d[field.colId] / d[field.colId + '-total'];\n        d[filteredOutField_1.colId] = 1;\n      });\n      var opaqueSeries = chart.series[1];\n      var radiusField = filteredOutField_1;\n      opaqueSeries = this.updateSeries(chart, opaqueSeries, angleField, radiusField, params, undefined);\n      radiusField = angleField;\n      var filteredSeries = chart.series[0];\n      this.updateSeries(chart, filteredSeries, angleField, radiusField, params, opaqueSeries);\n    } else {\n      var series = chart.series[0];\n      this.updateSeries(chart, series, angleField, angleField, params, undefined);\n    }\n  };\n\n  PieChartProxy.prototype.updateSeries = function (chart, series, angleField, field, params, opaqueSeries) {\n    var existingSeriesId = series && series.angleKey;\n    var seriesDefaults = this.iChartOptions.seriesDefaults;\n    var pieSeries = series;\n\n    if (existingSeriesId !== field.colId) {\n      chart.removeSeries(series);\n\n      var options = __assign(__assign({}, seriesDefaults), {\n        type: 'pie',\n        angleKey: this.crossFiltering ? angleField.colId + '-total' : angleField.colId,\n        radiusKey: this.crossFiltering ? field.colId : undefined,\n        title: __assign(__assign({}, seriesDefaults.title), {\n          text: seriesDefaults.title.text || params.fields[0].displayName\n        }),\n        fills: seriesDefaults.fill.colors,\n        fillOpacity: seriesDefaults.fill.opacity,\n        strokes: seriesDefaults.stroke.colors,\n        strokeOpacity: seriesDefaults.stroke.opacity,\n        strokeWidth: seriesDefaults.stroke.width,\n        tooltip: {\n          enabled: seriesDefaults.tooltip && seriesDefaults.tooltip.enabled,\n          renderer: seriesDefaults.tooltip && seriesDefaults.tooltip.enabled && seriesDefaults.tooltip.renderer\n        }\n      });\n\n      pieSeries = AgChart.createComponent(options, 'pie.series');\n\n      if (this.crossFiltering && pieSeries && !pieSeries.tooltip.renderer) {\n        // only add renderer if user hasn't provided one\n        this.addCrossFilteringTooltipRenderer(pieSeries);\n      }\n    }\n\n    pieSeries.angleName = field.displayName;\n    pieSeries.labelKey = params.category.id;\n    pieSeries.labelName = params.category.name;\n    pieSeries.data = params.data;\n\n    if (this.crossFiltering) {\n      pieSeries.radiusMin = 0;\n      pieSeries.radiusMax = 1;\n      var isOpaqueSeries = !opaqueSeries;\n\n      if (isOpaqueSeries) {\n        pieSeries.fills = this.changeOpacity(pieSeries.fills, 0.3);\n        pieSeries.strokes = this.changeOpacity(pieSeries.strokes, 0.3);\n        pieSeries.showInLegend = false;\n      } else {\n        chart.legend.addEventListener('click', function (event) {\n          if (opaqueSeries) {\n            opaqueSeries.toggleSeriesItem(event.itemId, event.enabled);\n          }\n        });\n      }\n\n      chart.tooltip.delay = 500; // disable series highlighting by default\n\n      pieSeries.highlightStyle.fill = undefined;\n      pieSeries.addEventListener(\"nodeClick\", this.crossFilterCallback);\n    }\n\n    chart.addSeries(pieSeries);\n    return pieSeries;\n  };\n\n  PieChartProxy.prototype.extractIChartOptionsFromTheme = function (theme) {\n    var options = _super.prototype.extractIChartOptionsFromTheme.call(this, theme);\n\n    var seriesDefaults = theme.getConfig('pie.series.pie');\n    options.seriesDefaults = {\n      title: seriesDefaults.title,\n      label: seriesDefaults.label,\n      callout: seriesDefaults.callout,\n      shadow: seriesDefaults.shadow,\n      tooltip: {\n        enabled: seriesDefaults.tooltip && seriesDefaults.tooltip.enabled,\n        renderer: seriesDefaults.tooltip && seriesDefaults.tooltip.renderer\n      },\n      fill: {\n        colors: seriesDefaults.fills || theme.palette.fills,\n        opacity: seriesDefaults.fillOpacity\n      },\n      stroke: {\n        colors: seriesDefaults.strokes || theme.palette.strokes,\n        opacity: seriesDefaults.strokeOpacity,\n        width: seriesDefaults.strokeWidth\n      },\n      lineDash: seriesDefaults.lineDash,\n      lineDashOffset: seriesDefaults.lineDashOffset,\n      highlightStyle: seriesDefaults.highlightStyle,\n      listeners: seriesDefaults.listeners\n    };\n    var callout = options.seriesDefaults.callout;\n\n    if (callout && !callout.colors) {\n      callout.colors = options.seriesDefaults.fill.colors;\n    }\n\n    return options;\n  }; // TODO: should be removed along with processChartOptions()\n\n\n  PieChartProxy.prototype.getDefaultOptions = function () {\n    var strokes = this.getPredefinedPalette().strokes;\n    var options = this.getDefaultChartOptions();\n    var fontOptions = this.getDefaultFontOptions();\n    options.seriesDefaults = __assign(__assign({}, options.seriesDefaults), {\n      title: __assign(__assign({}, fontOptions), {\n        enabled: false,\n        fontSize: 12,\n        fontWeight: 'bold'\n      }),\n      callout: {\n        colors: strokes,\n        length: 10,\n        strokeWidth: 2\n      },\n      label: __assign(__assign({}, fontOptions), {\n        enabled: false,\n        offset: 3,\n        minAngle: 0\n      }),\n      tooltip: {\n        enabled: true\n      },\n      shadow: this.getDefaultDropShadowOptions()\n    });\n    return options;\n  };\n\n  return PieChartProxy;\n}(PolarChartProxy);\n\nexport { PieChartProxy };","map":{"version":3,"sources":["C:/dev/streamlit-aggrid/st_aggrid/frontend/node_modules/@ag-grid-enterprise/charts/dist/es6/charts/chartComp/chartProxies/polar/pieChartProxy.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__assign","assign","t","s","i","n","arguments","length","call","apply","AgChart","PolarChartProxy","PieChartProxy","_super","params","_this","initChartOptions","recreateChart","createChart","options","iChartOptions","seriesDefaults","agChartOptions","autoSize","series","fills","fill","colors","fillOpacity","opacity","strokes","stroke","strokeOpacity","strokeWidth","width","type","chartProxyParams","parentElement","update","chart","fields","removeAllSeries","field","angleField","crossFiltering","fields_1","forEach","crossFilteringField","colId","push","filteredOutField_1","data","opaqueSeries","radiusField","updateSeries","undefined","filteredSeries","existingSeriesId","angleKey","pieSeries","removeSeries","radiusKey","title","text","displayName","tooltip","enabled","renderer","createComponent","addCrossFilteringTooltipRenderer","angleName","labelKey","category","id","labelName","name","radiusMin","radiusMax","isOpaqueSeries","changeOpacity","showInLegend","legend","addEventListener","event","toggleSeriesItem","itemId","delay","highlightStyle","crossFilterCallback","addSeries","extractIChartOptionsFromTheme","theme","getConfig","label","callout","shadow","palette","lineDash","lineDashOffset","listeners","getDefaultOptions","getPredefinedPalette","getDefaultChartOptions","fontOptions","getDefaultFontOptions","fontSize","fontWeight","offset","minAngle","getDefaultDropShadowOptions"],"mappings":"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","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport { AgChart } from \"ag-charts-community\";\nimport { PolarChartProxy } from \"./polarChartProxy\";\nvar PieChartProxy = /** @class */ (function (_super) {\n    __extends(PieChartProxy, _super);\n    function PieChartProxy(params) {\n        var _this = _super.call(this, params) || this;\n        _this.initChartOptions();\n        _this.recreateChart();\n        return _this;\n    }\n    PieChartProxy.prototype.createChart = function () {\n        var options = this.iChartOptions;\n        var seriesDefaults = options.seriesDefaults;\n        var agChartOptions = options;\n        agChartOptions.autoSize = true;\n        agChartOptions.series = [__assign(__assign({}, seriesDefaults), { fills: seriesDefaults.fill.colors, fillOpacity: seriesDefaults.fill.opacity, strokes: seriesDefaults.stroke.colors, strokeOpacity: seriesDefaults.stroke.opacity, strokeWidth: seriesDefaults.stroke.width, type: 'pie' })];\n        return AgChart.create(agChartOptions, this.chartProxyParams.parentElement);\n    };\n    PieChartProxy.prototype.update = function (params) {\n        var chart = this.chart;\n        if (params.fields.length === 0) {\n            chart.removeAllSeries();\n            return;\n        }\n        var field = params.fields[0];\n        var angleField = field;\n        if (this.crossFiltering) {\n            // add additional filtered out field\n            var fields_1 = params.fields;\n            fields_1.forEach(function (field) {\n                var crossFilteringField = __assign({}, field);\n                crossFilteringField.colId = field.colId + '-filtered-out';\n                fields_1.push(crossFilteringField);\n            });\n            var filteredOutField_1 = fields_1[1];\n            params.data.forEach(function (d) {\n                d[field.colId + '-total'] = d[field.colId] + d[filteredOutField_1.colId];\n                d[field.colId] = d[field.colId] / d[field.colId + '-total'];\n                d[filteredOutField_1.colId] = 1;\n            });\n            var opaqueSeries = chart.series[1];\n            var radiusField = filteredOutField_1;\n            opaqueSeries = this.updateSeries(chart, opaqueSeries, angleField, radiusField, params, undefined);\n            radiusField = angleField;\n            var filteredSeries = chart.series[0];\n            this.updateSeries(chart, filteredSeries, angleField, radiusField, params, opaqueSeries);\n        }\n        else {\n            var series = chart.series[0];\n            this.updateSeries(chart, series, angleField, angleField, params, undefined);\n        }\n    };\n    PieChartProxy.prototype.updateSeries = function (chart, series, angleField, field, params, opaqueSeries) {\n        var existingSeriesId = series && series.angleKey;\n        var seriesDefaults = this.iChartOptions.seriesDefaults;\n        var pieSeries = series;\n        if (existingSeriesId !== field.colId) {\n            chart.removeSeries(series);\n            var options = __assign(__assign({}, seriesDefaults), { type: 'pie', angleKey: this.crossFiltering ? angleField.colId + '-total' : angleField.colId, radiusKey: this.crossFiltering ? field.colId : undefined, title: __assign(__assign({}, seriesDefaults.title), { text: seriesDefaults.title.text || params.fields[0].displayName }), fills: seriesDefaults.fill.colors, fillOpacity: seriesDefaults.fill.opacity, strokes: seriesDefaults.stroke.colors, strokeOpacity: seriesDefaults.stroke.opacity, strokeWidth: seriesDefaults.stroke.width, tooltip: {\n                    enabled: seriesDefaults.tooltip && seriesDefaults.tooltip.enabled,\n                    renderer: seriesDefaults.tooltip && seriesDefaults.tooltip.enabled && seriesDefaults.tooltip.renderer,\n                } });\n            pieSeries = AgChart.createComponent(options, 'pie.series');\n            if (this.crossFiltering && pieSeries && !pieSeries.tooltip.renderer) {\n                // only add renderer if user hasn't provided one\n                this.addCrossFilteringTooltipRenderer(pieSeries);\n            }\n        }\n        pieSeries.angleName = field.displayName;\n        pieSeries.labelKey = params.category.id;\n        pieSeries.labelName = params.category.name;\n        pieSeries.data = params.data;\n        if (this.crossFiltering) {\n            pieSeries.radiusMin = 0;\n            pieSeries.radiusMax = 1;\n            var isOpaqueSeries = !opaqueSeries;\n            if (isOpaqueSeries) {\n                pieSeries.fills = this.changeOpacity(pieSeries.fills, 0.3);\n                pieSeries.strokes = this.changeOpacity(pieSeries.strokes, 0.3);\n                pieSeries.showInLegend = false;\n            }\n            else {\n                chart.legend.addEventListener('click', function (event) {\n                    if (opaqueSeries) {\n                        opaqueSeries.toggleSeriesItem(event.itemId, event.enabled);\n                    }\n                });\n            }\n            chart.tooltip.delay = 500;\n            // disable series highlighting by default\n            pieSeries.highlightStyle.fill = undefined;\n            pieSeries.addEventListener(\"nodeClick\", this.crossFilterCallback);\n        }\n        chart.addSeries(pieSeries);\n        return pieSeries;\n    };\n    PieChartProxy.prototype.extractIChartOptionsFromTheme = function (theme) {\n        var options = _super.prototype.extractIChartOptionsFromTheme.call(this, theme);\n        var seriesDefaults = theme.getConfig('pie.series.pie');\n        options.seriesDefaults = {\n            title: seriesDefaults.title,\n            label: seriesDefaults.label,\n            callout: seriesDefaults.callout,\n            shadow: seriesDefaults.shadow,\n            tooltip: {\n                enabled: seriesDefaults.tooltip && seriesDefaults.tooltip.enabled,\n                renderer: seriesDefaults.tooltip && seriesDefaults.tooltip.renderer\n            },\n            fill: {\n                colors: seriesDefaults.fills || theme.palette.fills,\n                opacity: seriesDefaults.fillOpacity\n            },\n            stroke: {\n                colors: seriesDefaults.strokes || theme.palette.strokes,\n                opacity: seriesDefaults.strokeOpacity,\n                width: seriesDefaults.strokeWidth\n            },\n            lineDash: seriesDefaults.lineDash,\n            lineDashOffset: seriesDefaults.lineDashOffset,\n            highlightStyle: seriesDefaults.highlightStyle,\n            listeners: seriesDefaults.listeners\n        };\n        var callout = options.seriesDefaults.callout;\n        if (callout && !callout.colors) {\n            callout.colors = options.seriesDefaults.fill.colors;\n        }\n        return options;\n    };\n    // TODO: should be removed along with processChartOptions()\n    PieChartProxy.prototype.getDefaultOptions = function () {\n        var strokes = this.getPredefinedPalette().strokes;\n        var options = this.getDefaultChartOptions();\n        var fontOptions = this.getDefaultFontOptions();\n        options.seriesDefaults = __assign(__assign({}, options.seriesDefaults), { title: __assign(__assign({}, fontOptions), { enabled: false, fontSize: 12, fontWeight: 'bold' }), callout: {\n                colors: strokes,\n                length: 10,\n                strokeWidth: 2,\n            }, label: __assign(__assign({}, fontOptions), { enabled: false, offset: 3, minAngle: 0 }), tooltip: {\n                enabled: true,\n            }, shadow: this.getDefaultDropShadowOptions() });\n        return options;\n    };\n    return PieChartProxy;\n}(PolarChartProxy));\nexport { PieChartProxy };\n"]},"metadata":{},"sourceType":"module"}